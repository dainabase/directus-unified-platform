name: Organize Root Cleanup - Phase 2

on:
  push:
    branches: [ organize-root-cleanup ]
  workflow_dispatch:

jobs:
  organize-root:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
    
    - name: Make script executable
      run: chmod +x ORGANIZE_ROOT_CLEANUP.sh
    
    - name: Run organization script
      run: |
        bash ORGANIZE_ROOT_CLEANUP.sh
    
    - name: Show results
      run: |
        echo "üìä Root cleanup complete!"
        echo ""
        echo "Files in tools/:"
        ls -la tools/ || echo "Empty"
        echo ""
        echo "Files in docs/archive/:"
        ls -la docs/archive/ || echo "Empty"
        echo ""
        echo "Files remaining at root:"
        ls -1 *.{js,sh,sql,md,html} 2>/dev/null | wc -l
        echo ""
        echo "Files in temp/ (to be deleted):"
        ls -la temp/ || echo "Empty"
    
    - name: Remove temp directory
      run: |
        echo "üóëÔ∏è Removing temporary files..."
        rm -rf temp/
        echo "‚úÖ Temp directory removed"
    
    - name: Commit changes
      run: |
        git config --local user.email "admin@dainamics.ch"
        git config --local user.name "dainabase"
        git add .
        git diff --staged --quiet || git commit -m "‚úÖ Root cleanup executed - 85+ files organized

        - Moved test files to tools/testing/
        - Moved validation scripts to tools/validation/
        - Moved migration scripts to tools/migration/
        - Moved cleanup scripts to tools/cleanup/
        - Archived temporary documentation to docs/archive/
        - Removed temporary files (.token, .pid, etc.)
        
        Root now contains only essential files."
        git push origin organize-root-cleanup