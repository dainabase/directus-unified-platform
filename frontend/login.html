<!doctype html>
<html lang="fr">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
    <title>Connexion - Directus Platform</title>
    
    <!-- Tabler CSS -->
    <link href="https://cdn.jsdelivr.net/npm/@tabler/core@latest/dist/css/tabler.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@tabler/icons@latest/iconfont/tabler-icons.min.css">
    <link href="./assets/css/custom.css" rel="stylesheet">
</head>
<body class="d-flex flex-column">
    <div class="page page-center">
        <div class="container container-tight py-4">
            <div class="text-center mb-4">
                <a href="." class="navbar-brand navbar-brand-autodark">
                    <h1>Directus Platform</h1>
                </a>
            </div>
            
            <div class="card card-md">
                <div class="card-body">
                    <h2 class="h2 text-center mb-4">Connexion</h2>
                    
                    <!-- Role selector for dev mode -->
                    <div class="mb-3">
                        <label class="form-label">Rôle (mode développement)</label>
                        <div class="form-selectgroup">
                            <label class="form-selectgroup-item">
                                <input type="radio" name="role" value="superadmin" class="form-selectgroup-input" checked>
                                <span class="form-selectgroup-label">
                                    <i class="ti ti-crown"></i> SuperAdmin
                                </span>
                            </label>
                            <label class="form-selectgroup-item">
                                <input type="radio" name="role" value="client" class="form-selectgroup-input">
                                <span class="form-selectgroup-label">
                                    <i class="ti ti-user"></i> Client
                                </span>
                            </label>
                            <label class="form-selectgroup-item">
                                <input type="radio" name="role" value="prestataire" class="form-selectgroup-input">
                                <span class="form-selectgroup-label">
                                    <i class="ti ti-tools"></i> Prestataire
                                </span>
                            </label>
                            <label class="form-selectgroup-item">
                                <input type="radio" name="role" value="revendeur" class="form-selectgroup-input">
                                <span class="form-selectgroup-label">
                                    <i class="ti ti-shopping-cart"></i> Revendeur
                                </span>
                            </label>
                        </div>
                    </div>
                    
                    <form id="loginForm" autocomplete="off" novalidate>
                        <div class="mb-3">
                            <label class="form-label">Email</label>
                            <input type="email" id="email" class="form-control" placeholder="your@email.com" autocomplete="off" value="admin@directus.io">
                        </div>
                        
                        <div class="mb-2">
                            <label class="form-label">
                                Mot de passe
                                <span class="form-label-description">
                                    <a href="./forgot-password.html">Mot de passe oublié</a>
                                </span>
                            </label>
                            <div class="input-group input-group-flat">
                                <input type="password" id="password" class="form-control" placeholder="Votre mot de passe" autocomplete="off" value="admin">
                                <span class="input-group-text">
                                    <a href="#" class="link-secondary toggle-password" title="Afficher le mot de passe" data-bs-toggle="tooltip">
                                        <i class="ti ti-eye"></i>
                                    </a>
                                </span>
                            </div>
                        </div>
                        
                        <div class="mb-2">
                            <label class="form-check">
                                <input type="checkbox" class="form-check-input"/>
                                <span class="form-check-label">Se souvenir de moi</span>
                            </label>
                        </div>
                        
                        <div class="form-footer">
                            <button type="submit" class="btn btn-primary w-100">
                                <i class="ti ti-login"></i> Se connecter
                            </button>
                        </div>
                    </form>
                </div>
            </div>
            
            <div class="text-center text-secondary mt-3">
                <div class="alert alert-info">
                    <strong>Mode développement</strong><br>
                    Sélectionnez un rôle et cliquez sur "Se connecter"
                </div>
            </div>
        </div>
    </div>
    
    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/@tabler/core@latest/dist/js/tabler.min.js"></script>
    <script src="./assets/js/app.js"></script>
    <script src="./assets/js/auth-directus.js"></script>
    
    <script>
        document.getElementById('loginForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const selectedRole = document.querySelector('input[name="role"]:checked').value;
            
            // For dev mode, modify email to include role
            const modifiedEmail = selectedRole + '@directus.io';
            
            // Login with modified email to set correct role
            const result = await window.AuthDirectus.login(modifiedEmail, password);
            
            if (result.success) {
                window.App.utils.showAlert('Connexion réussie! Redirection...', 'success');
                
                // Redirect based on role
                setTimeout(() => {
                    switch(selectedRole) {
                        case 'superadmin':
                            window.location.href = '/superadmin/dashboard.html';
                            break;
                        case 'client':
                            window.location.href = '/client/dashboard.html';
                            break;
                        case 'prestataire':
                            window.location.href = '/prestataire/dashboard.html';
                            break;
                        case 'revendeur':
                            window.location.href = '/revendeur/dashboard.html';
                            break;
                        default:
                            window.location.href = '/';
                    }
                }, 1000);
            } else {
                window.App.utils.showAlert('Erreur de connexion', 'danger');
            }
        });
        
        // Toggle password visibility
        document.querySelector('.toggle-password').addEventListener('click', function(e) {
            e.preventDefault();
            const passwordInput = document.getElementById('password');
            const icon = this.querySelector('i');
            
            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                icon.className = 'ti ti-eye-off';
            } else {
                passwordInput.type = 'password';
                icon.className = 'ti ti-eye';
            }
        });
    </script>
</body>
</html>