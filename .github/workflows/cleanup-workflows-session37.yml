name: Cleanup Workflows - Session 37

on:
  workflow_dispatch:

jobs:
  cleanup:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
      
      - name: Delete Unused NPM Workflows
        run: |
          echo "ðŸ§¹ Cleaning up unused workflows..."
          
          # List of workflows to delete
          WORKFLOWS_TO_DELETE=(
            ".github/workflows/emergency-npm-publish.yml"
            ".github/workflows/final-solution-npm.yml"
            ".github/workflows/ultra-fix-everything.yml"
            ".github/workflows/complete-solution.yml"
            ".github/workflows/auto-fix-build.yml"
            ".github/workflows/fix-build-deps.yml"
            ".github/workflows/npm-publish-production.yml"
            ".github/workflows/npm-publish-ultra-simple.yml"
          )
          
          # Additional NPM-related workflows to consider
          NPM_WORKFLOWS=(
            ".github/workflows/npm-auto-publish.yml"
            ".github/workflows/npm-publish-beta.yml"
            ".github/workflows/npm-publish-force.yml"
            ".github/workflows/npm-publish-minimal.yml"
            ".github/workflows/npm-publish-simple.yml"
            ".github/workflows/npm-publish-ui-v1.3.0.yml"
            ".github/workflows/npm-publish-ui.yml"
            ".github/workflows/npm-publish-v1.2.0.yml"
            ".github/workflows/npm-publish-with-deps.yml"
            ".github/workflows/npm-publish.yml"
            ".github/workflows/npm-release.yml"
            ".github/workflows/fix-deps-and-publish.yml"
            ".github/workflows/fix-lock-and-publish.yml"
          )
          
          # Delete primary list
          for workflow in "${WORKFLOWS_TO_DELETE[@]}"; do
            if [ -f "$workflow" ]; then
              rm -f "$workflow"
              echo "âœ… Deleted: $workflow"
            else
              echo "âš ï¸ Not found: $workflow"
            fi
          done
          
          # Delete NPM workflows (since we're not publishing to NPM)
          for workflow in "${NPM_WORKFLOWS[@]}"; do
            if [ -f "$workflow" ]; then
              rm -f "$workflow"
              echo "âœ… Deleted NPM workflow: $workflow"
            fi
          done
          
          # Rename simple-build-publish.yml to build-local.yml
          if [ -f ".github/workflows/simple-build-publish.yml" ]; then
            mv .github/workflows/simple-build-publish.yml .github/workflows/build-local.yml
            echo "âœ… Renamed: simple-build-publish.yml â†’ build-local.yml"
          fi
          
          echo "ðŸŽ‰ Workflow cleanup complete!"
          
      - name: Commit Changes
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          
          git add -A
          git diff --staged --quiet || git commit -m "chore: cleanup unused workflows (Session 37)

          - Removed 8+ unused NPM publish workflows
          - Removed emergency and fix workflows
          - Renamed simple-build-publish.yml to build-local.yml
          - No NPM publication needed (local use only)"
          
          git push
          
      - name: Summary
        run: |
          echo "## ðŸ§¹ Workflow Cleanup Results" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### Deleted Workflows:" >> $GITHUB_STEP_SUMMARY
          echo "- emergency-npm-publish.yml âŒ" >> $GITHUB_STEP_SUMMARY
          echo "- final-solution-npm.yml âŒ" >> $GITHUB_STEP_SUMMARY
          echo "- ultra-fix-everything.yml âŒ" >> $GITHUB_STEP_SUMMARY
          echo "- complete-solution.yml âŒ" >> $GITHUB_STEP_SUMMARY
          echo "- auto-fix-build.yml âŒ" >> $GITHUB_STEP_SUMMARY
          echo "- fix-build-deps.yml âŒ" >> $GITHUB_STEP_SUMMARY
          echo "- npm-publish-production.yml âŒ" >> $GITHUB_STEP_SUMMARY
          echo "- npm-publish-ultra-simple.yml âŒ" >> $GITHUB_STEP_SUMMARY
          echo "- All other NPM-related workflows âŒ" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### Renamed:" >> $GITHUB_STEP_SUMMARY
          echo "- simple-build-publish.yml â†’ build-local.yml âœ…" >> $GITHUB_STEP_SUMMARY
