<!DOCTYPE html>
<html lang="fr" data-bs-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard ERP - SuperAdmin</title>
    
    <!-- Tabler CSS -->
    <link href="../../shared/tabler/dist/css/tabler.min.css" rel="stylesheet"/>
    <link href="../../shared/tabler/dist/css/tabler-flags.min.css" rel="stylesheet"/>
    <link href="../../shared/tabler/dist/css/tabler-payments.min.css" rel="stylesheet"/>
    <link href="../../shared/tabler/dist/css/tabler-vendors.min.css" rel="stylesheet"/>
    
    <!-- Custom CSS -->
    <link href="css/modern-theme.css" rel="stylesheet">
    <link href="css/glassmorphism.css" rel="stylesheet">
    <link href="css/animations.css" rel="stylesheet">
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="mesh-gradient-bg">
    <div class="page">
        <!-- Header -->
        <header class="navbar navbar-expand-md navbar-dark glassmorphism-card m-3 slide-in-top">
            <div class="container-xl">
                <h1 class="navbar-brand d-none-navbar-horizontal pe-0 pe-md-3">
                    <a href="dashboard.html" class="text-decoration-none">
                        <span class="text-gradient">SuperAdmin</span> - Dashboard ERP
                    </a>
                </h1>
                <div class="navbar-nav flex-row order-md-last">
                    <div class="nav-item dropdown">
                        <a href="#" class="nav-link d-flex lh-1 text-reset p-0" data-bs-toggle="dropdown">
                            <span class="avatar avatar-sm glassmorphism-hover">JM</span>
                            <div class="d-none d-xl-block ps-2">
                                <div>Jean-Marie</div>
                                <div class="mt-1 small text-muted">Administrateur</div>
                            </div>
                        </a>
                    </div>
                </div>
            </div>
        </header>

        <!-- Page content -->
        <div class="page-wrapper">
            <div class="container-xl">
                <!-- Page header -->
                <div class="page-header d-print-none mb-4">
                    <div class="row g-2 align-items-center">
                        <div class="col">
                            <div class="page-pretitle slide-in-left">
                                Système ERP intégré
                            </div>
                            <h2 class="page-title text-gradient slide-in-left">
                                Tableau de bord ERPNext
                            </h2>
                        </div>
                        <div class="col-auto ms-auto d-print-none slide-in-right">
                            <!-- Sélecteur d'entreprise -->
                            <div class="btn-list">
                                <select class="form-select glassmorphism-input" id="companySelector">
                                    <option value="all">Toutes les entreprises</option>
                                    <option value="HyperVisual">HyperVisual</option>
                                    <option value="Dynamics">Dynamics</option>
                                    <option value="Lexia">Lexia</option>
                                    <option value="NKReality">NKReality</option>
                                    <option value="Etekout">Etekout</option>
                                </select>
                                <button class="btn btn-primary glassmorphism-hover" onclick="window.open('http://localhost:8083', '_blank')">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none">
                                        <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                        <path d="M11 7h-5a2 2 0 0 0 -2 2v9a2 2 0 0 0 2 2h9a2 2 0 0 0 2 -2v-5" />
                                        <line x1="10" y1="14" x2="20" y2="4" />
                                        <polyline points="15 4 20 4 20 9" />
                                    </svg>
                                    Ouvrir ERPNext
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- KPIs Row -->
                <div class="row row-deck row-cards mb-4">
                    <div class="col-sm-6 col-lg-3 zoom-in">
                        <div class="card glassmorphism-card glow-effect-primary">
                            <div class="card-body">
                                <div class="d-flex align-items-center">
                                    <div class="subheader">CA du mois</div>
                                    <div class="ms-auto lh-1">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="icon text-success" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none">
                                            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                            <path d="M3 17l6 -6l4 4l8 -8" />
                                            <path d="M14 7l7 0l0 7" />
                                        </svg>
                                    </div>
                                </div>
                                <div class="h1 mb-3 text-gradient" id="kpiRevenue">0 CHF</div>
                                <div class="d-flex mb-2">
                                    <div>Évolution mensuelle</div>
                                    <div class="ms-auto">
                                        <span class="text-success d-inline-flex align-items-center lh-1">
                                            +12% <svg xmlns="http://www.w3.org/2000/svg" class="icon ms-1" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none">
                                                <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                                <polyline points="3 17 9 11 13 15 21 7" />
                                                <polyline points="14 7 21 7 21 14" />
                                            </svg>
                                        </span>
                                    </div>
                                </div>
                                <div class="progress progress-sm glassmorphism-progress">
                                    <div class="progress-bar bg-primary" style="width: 75%" role="progressbar"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-sm-6 col-lg-3 zoom-in" style="animation-delay: 0.1s">
                        <div class="card glassmorphism-card glow-effect-warning">
                            <div class="card-body">
                                <div class="d-flex align-items-center">
                                    <div class="subheader">Factures en attente</div>
                                    <div class="ms-auto lh-1">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="icon text-warning" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none">
                                            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                            <circle cx="12" cy="12" r="9" />
                                            <polyline points="12 7 12 12 15 15" />
                                        </svg>
                                    </div>
                                </div>
                                <div class="h1 mb-3 text-gradient" id="kpiPendingInvoices">0</div>
                                <div class="d-flex mb-2">
                                    <div>Montant total</div>
                                    <div class="ms-auto">
                                        <span id="pendingAmount">0 CHF</span>
                                    </div>
                                </div>
                                <div class="progress progress-sm glassmorphism-progress">
                                    <div class="progress-bar bg-warning" style="width: 25%" role="progressbar"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-sm-6 col-lg-3 zoom-in" style="animation-delay: 0.2s">
                        <div class="card glassmorphism-card glow-effect-info">
                            <div class="card-body">
                                <div class="d-flex align-items-center">
                                    <div class="subheader">Valeur du stock</div>
                                    <div class="ms-auto lh-1">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="icon text-info" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none">
                                            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                            <path d="M3 21v-13l9 -4l9 4v13" />
                                            <path d="M13 13h4v8h-10v-6h6" />
                                            <path d="M13 21v-9a1 1 0 0 0 -1 -1h-2a1 1 0 0 0 -1 1v3" />
                                        </svg>
                                    </div>
                                </div>
                                <div class="h1 mb-3 text-gradient" id="kpiStock">0 CHF</div>
                                <div class="d-flex mb-2">
                                    <div>Articles en stock</div>
                                    <div class="ms-auto">
                                        <span id="stockItems">0</span>
                                    </div>
                                </div>
                                <div class="progress progress-sm glassmorphism-progress">
                                    <div class="progress-bar bg-info" style="width: 60%" role="progressbar"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-sm-6 col-lg-3 zoom-in" style="animation-delay: 0.3s">
                        <div class="card glassmorphism-card glow-effect-success">
                            <div class="card-body">
                                <div class="d-flex align-items-center">
                                    <div class="subheader">Employés actifs</div>
                                    <div class="ms-auto lh-1">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="icon text-success" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none">
                                            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                            <circle cx="9" cy="7" r="4" />
                                            <path d="M3 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
                                            <path d="M16 3.13a4 4 0 0 1 0 7.75" />
                                            <path d="M21 21v-2a4 4 0 0 0 -3 -3.85" />
                                        </svg>
                                    </div>
                                </div>
                                <div class="h1 mb-3 text-gradient" id="kpiEmployees">0</div>
                                <div class="d-flex mb-2">
                                    <div>Taux de présence</div>
                                    <div class="ms-auto">
                                        <span class="text-success">95%</span>
                                    </div>
                                </div>
                                <div class="progress progress-sm glassmorphism-progress">
                                    <div class="progress-bar bg-success" style="width: 95%" role="progressbar"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="row mb-4">
                    <div class="col-12">
                        <div class="card glassmorphism-card fade-in">
                            <div class="card-header">
                                <h3 class="card-title text-gradient">Actions rapides</h3>
                            </div>
                            <div class="card-body">
                                <div class="btn-list">
                                    <button class="btn glassmorphism-hover" onclick="ERPModule.createInvoice()">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none">
                                            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                            <path d="M14 3v4a1 1 0 0 0 1 1h4" />
                                            <path d="M17 21h-10a2 2 0 0 1 -2 -2v-14a2 2 0 0 1 2 -2h7l5 5v11a2 2 0 0 1 -2 2z" />
                                            <line x1="9" y1="7" x2="10" y2="7" />
                                            <line x1="9" y1="13" x2="15" y2="13" />
                                            <line x1="13" y1="17" x2="15" y2="17" />
                                        </svg>
                                        Nouvelle facture
                                    </button>
                                    <button class="btn glassmorphism-hover" onclick="ERPModule.createCustomer()">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none">
                                            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                            <circle cx="12" cy="7" r="4" />
                                            <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
                                        </svg>
                                        Nouveau client
                                    </button>
                                    <button class="btn glassmorphism-hover" onclick="ERPModule.createItem()">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none">
                                            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                            <rect x="4" y="4" width="6" height="6" rx="1" />
                                            <rect x="14" y="4" width="6" height="6" rx="1" />
                                            <rect x="4" y="14" width="6" height="6" rx="1" />
                                            <rect x="14" y="14" width="6" height="6" rx="1" />
                                        </svg>
                                        Nouvel article
                                    </button>
                                    <button class="btn glassmorphism-hover" onclick="ERPModule.syncData()">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler-refresh" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none">
                                            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                            <path d="M20 11a8.1 8.1 0 0 0 -15.5 -2m-.5 -4v4h4" />
                                            <path d="M4 13a8.1 8.1 0 0 0 15.5 2m.5 4v-4h-4" />
                                        </svg>
                                        Synchroniser
                                    </button>
                                    <button class="btn btn-primary glassmorphism-hover" onclick="ERPModule.runMigration()">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none">
                                            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                            <path d="M19 11v-2a2 2 0 0 0 -2 -2h-8a2 2 0 0 0 -2 2v8a2 2 0 0 0 2 2h2" />
                                            <path d="M13 13l9 3l-4 2l-2 4l-3 -9" />
                                            <line x1="3" y1="3" x2="3" y2="3.01" />
                                            <line x1="7" y1="3" x2="7" y2="3.01" />
                                            <line x1="11" y1="3" x2="11" y2="3.01" />
                                            <line x1="15" y1="3" x2="15" y2="3.01" />
                                            <line x1="3" y1="7" x2="3" y2="7.01" />
                                            <line x1="3" y1="11" x2="3" y2="11.01" />
                                        </svg>
                                        Migrer depuis Directus
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Charts Row -->
                <div class="row row-deck row-cards">
                    <div class="col-lg-8">
                        <div class="card glassmorphism-card slide-in-left">
                            <div class="card-header">
                                <h3 class="card-title text-gradient">Évolution du chiffre d'affaires</h3>
                            </div>
                            <div class="card-body">
                                <div class="chart-container" style="position: relative; height:300px;">
                                    <canvas id="revenueChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-4">
                        <div class="card glassmorphism-card slide-in-right">
                            <div class="card-header">
                                <h3 class="card-title text-gradient">Répartition par entreprise</h3>
                            </div>
                            <div class="card-body">
                                <div class="chart-container" style="position: relative; height:300px;">
                                    <canvas id="companyChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Recent Activities -->
                <div class="row mt-4">
                    <div class="col-12">
                        <div class="card glassmorphism-card fade-in">
                            <div class="card-header">
                                <h3 class="card-title text-gradient">Activités récentes</h3>
                            </div>
                            <div class="card-body">
                                <div class="list-group list-group-flush" id="recentActivities">
                                    <div class="text-center text-muted py-4">
                                        <div class="spinner-border spinner-border-sm me-2" role="status"></div>
                                        Chargement des activités...
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Tabler JS -->
    <script src="../../shared/tabler/dist/js/tabler.min.js"></script>
    
    <!-- Custom JS -->
    <script src="js/theme-manager.js"></script>
    <script src="js/erp-module.js"></script>
    
    <script>
        // Initialiser le module ERP
        document.addEventListener('DOMContentLoaded', function() {
            window.ERPModule.init();
            
            // Gérer le changement d'entreprise
            document.getElementById('companySelector').addEventListener('change', function() {
                window.ERPModule.loadDashboardData(this.value);
            });
        });
    </script>
</body>
</html>