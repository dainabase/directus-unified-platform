name: ğŸ§¹ One-Time Cleanup
run-name: Cleaning up empty workflows and duplicates

on:
  workflow_dispatch:
  push:
    paths:
      - '.github/workflows/one-time-cleanup.yml'

jobs:
  cleanup:
    name: Execute Repository Cleanup
    runs-on: ubuntu-latest
    permissions:
      contents: write
      
    steps:
      - name: ğŸ“¥ Checkout repository
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          
      - name: ğŸ”§ Make script executable
        run: chmod +x scripts/cleanup-repository.sh
        
      - name: ğŸ§¹ Execute cleanup
        run: |
          echo "Starting cleanup process..."
          bash scripts/cleanup-repository.sh
          
      - name: ğŸ“ Commit changes
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          git add -A
          git diff --staged --quiet || git commit -m "chore: ğŸ§¹ Cleanup empty workflows and resolve duplicates

          - Removed 14 empty workflow files (0 bytes)
          - Moved EMERGENCY_AUDIT.sh to scripts/
          - Moved MAINTENANCE_LOG.md to docs/
          - Removed duplicate .eslintrc.js (kept .eslintrc.json)
          - Removed duplicate .chromatic.config.json (kept chromatic.config.json)
          
          Part of #44"
          
      - name: ğŸ“¤ Push changes
        run: |
          git push origin main
          
      - name: ğŸ—‘ï¸ Self-destruct this workflow
        run: |
          rm -f .github/workflows/one-time-cleanup.yml
          git add .github/workflows/one-time-cleanup.yml
          git commit -m "chore: Remove one-time cleanup workflow after execution"
          git push origin main
          
      - name: âœ… Update issue
        uses: peter-evans/create-or-update-comment@v4
        with:
          issue-number: 44
          body: |
            ## âœ… Nettoyage automatique terminÃ© !
            
            ### ğŸ“Š RÃ©sultats:
            - âœ… 14 workflows vides supprimÃ©s
            - âœ… 2 fichiers dÃ©placÃ©s vers les bons dossiers
            - âœ… 2 doublons rÃ©solus
            - âœ… Script de nettoyage exÃ©cutÃ© avec succÃ¨s
            - âœ… Workflow temporaire auto-supprimÃ©
            
            ### ğŸ“ Ã‰tat final:
            - **Workflows actifs**: 6 (comme prÃ©vu)
            - **Repository**: Propre et organisÃ©
            - **PrÃªt pour**: Publication NPM v1.2.0
            
            ğŸš€ **Le repository est maintenant prÃªt pour la publication !**
