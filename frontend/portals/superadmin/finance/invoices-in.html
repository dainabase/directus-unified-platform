<!doctype html>
<html lang="fr">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
    <meta http-equiv="X-UA-Compatible" content="ie=edge"/>
    <title>Factures Fournisseurs - Finance Superadmin</title>
    
    <!-- CSS Tabler -->
    <link href="https://cdn.jsdelivr.net/npm/@tabler/core@latest/dist/css/tabler.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/@tabler/core@latest/dist/css/tabler-flags.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/@tabler/core@latest/dist/css/tabler-payments.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/@tabler/core@latest/dist/css/tabler-vendors.min.css" rel="stylesheet">
    
    <!-- Tabler Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@tabler/icons@latest/iconfont/tabler-icons.min.css">
    
    <!-- Custom CSS -->
    <link href="../../assets/css/custom.css" rel="stylesheet"/>
    <link href="../../assets/css/superadmin-custom.css" rel="stylesheet"/>
    
    <!-- DataTables CSS -->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.7/css/dataTables.bootstrap5.min.css">
    
    <style>
        /* JetBrains Mono pour les valeurs numériques */
        .metric-value,
        .h1,
        .total-value,
        .invoice-amount,
        .percentage-value,
        .stats-number,
        .amount-cell {
            font-family: 'JetBrains Mono', monospace !important;
            font-weight: 600;
        }
        
        /* Styles spécifiques factures */
        /* Utilisation des badges Tabler pour les statuts */
        .status-draft { }
        .status-pending { }
        .status-validated { }
        .status-paid { }
        .status-dispute { }
        .status-overdue {
            animation: pulse-red 2s infinite;
        }
        
        @keyframes pulse-red {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        /* Actions rapides */
        .quick-actions {
            display: flex;
            gap: 0.25rem;
        }
        
        .quick-action {
            width: 32px;
            height: 32px;
            border-radius: 4px;
            border: 1px solid #dee2e6;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .quick-action:hover {
            background: #f8f9fa;
            transform: translateY(-1px);
        }
        
        .quick-action.validate {
            color: #2fb344;
        }
        
        .quick-action.pay {
            color: #206bc4;
        }
        
        .quick-action.dispute {
            color: #d63939;
        }
        
        .quick-action.view {
            color: #6c757d;
        }
        
        /* Filtres */
        .filters-bar {
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1.5rem;
        }
        
        .filter-group {
            display: flex;
            gap: 1rem;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .filter-item {
            min-width: 150px;
        }
        
        /* Indicateurs échéances */
        .due-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 0.5rem;
        }
        
        .due-today {
            background: #f76707;
        }
        
        .due-soon {
            background: #fd7e14;
        }
        
        .due-normal {
            background: #28a745;
        }
        
        .due-overdue {
            background: #dc3545;
            animation: pulse-red 2s infinite;
        }
        
        /* Montants */
        .amount {
            font-family: 'JetBrains Mono', monospace;
            font-weight: 600;
            white-space: nowrap;
        }
        
        .amount.positive {
            color: #2fb344;
        }
        
        .amount.negative {
            color: #d63939;
        }
        
        /* Totaux */
        .totals-summary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 1.5rem;
            border-radius: 8px;
            margin-bottom: 1.5rem;
        }
        
        .total-item {
            text-align: center;
        }
        
        .total-label {
            font-size: 0.875rem;
            opacity: 0.9;
            margin-bottom: 0.25rem;
        }
        
        .total-value {
            font-size: 1.5rem;
            font-weight: 700;
            font-family: 'JetBrains Mono', monospace;
        }
        
        /* Workflow validation */
        .validation-steps {
            display: flex;
            gap: 1rem;
            align-items: center;
            padding: 0.5rem;
            background: #f8f9fa;
            border-radius: 4px;
            margin: 0.5rem 0;
        }
        
        .validation-step {
            display: flex;
            align-items: center;
            gap: 0.25rem;
            font-size: 0.75rem;
        }
        
        .validation-step.completed {
            color: #2fb344;
        }
        
        .validation-step.pending {
            color: #f76707;
        }
        
        .validation-step.rejected {
            color: #d63939;
        }
        
        /* Import OCR */
        .ocr-import-btn {
            position: relative;
            overflow: hidden;
        }
        
        .ocr-import-btn::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left 0.5s;
        }
        
        .ocr-import-btn:hover::after {
            left: 100%;
        }
        
        /* DataTable customizations */
        .dataTables_wrapper .dataTables_filter {
            float: right;
            margin-bottom: 1rem;
        }
        
        .dataTables_wrapper .dataTables_length {
            float: left;
            margin-bottom: 1rem;
        }
        
        .dataTables_wrapper .dataTables_info {
            margin-top: 1rem;
        }
        
        .dataTables_wrapper .dataTables_paginate {
            margin-top: 1rem;
            float: right;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .filter-group {
                flex-direction: column;
                gap: 0.5rem;
            }
            
            .filter-item {
                width: 100%;
                min-width: auto;
            }
            
            .quick-actions {
                justify-content: center;
            }
            
            .totals-summary .row {
                text-align: center;
            }
            
            .total-item {
                margin-bottom: 1rem;
            }
        }
        
        /* Dark mode pour tables */
        [data-bs-theme="dark"] .table {
            --bs-table-bg: transparent;
        }
        
        [data-bs-theme="dark"] .dataTables_wrapper {
            color: #adb5bd;
        }
        
        [data-bs-theme="dark"] .dataTables_wrapper .dataTables_filter input {
            background-color: #495057;
            border-color: #6c757d;
            color: #fff;
        }
        
        /* Dark mode toggle visibility */
        [data-bs-theme="dark"] .hide-theme-dark { display: none !important; }
        [data-bs-theme="light"] .hide-theme-light { display: none !important; }
    </style>
</head>
<body data-bs-theme="light">
    <div class="page">
        <!-- Sidebar -->
        <aside class="navbar navbar-vertical navbar-expand-lg navbar-superadmin" data-bs-theme="dark">
            <div class="container-fluid">
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#sidebar-menu">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <h1 class="navbar-brand navbar-brand-autodark">
                    <a href="../">
                        <img src="../../assets/img/logo.svg" width="110" height="32" alt="Dashboard" class="navbar-brand-image">
                    </a>
                </h1>
                <div class="collapse navbar-collapse" id="sidebar-menu">
                    <ul class="navbar-nav pt-lg-3">
                        <!-- Navigation dynamique -->
                    </ul>
                </div>
            </div>
        </aside>
        
        <!-- Header -->
        <header class="navbar navbar-expand-md d-none d-lg-flex d-print-none">
            <div class="container-xl">
                <div class="navbar-nav flex-row order-md-last">
                    <!-- Dark Mode Toggle -->
                    <div class="nav-item d-none d-md-flex me-3">
                        <div class="btn-list-item">
                            <a href="#" class="nav-link px-0 hide-theme-dark" title="Enable dark mode" data-bs-toggle="tooltip" data-bs-placement="bottom" onclick="document.body.setAttribute('data-bs-theme', 'dark')">
                                <i class="ti ti-moon"></i>
                            </a>
                            <a href="#" class="nav-link px-0 hide-theme-light" title="Enable light mode" data-bs-toggle="tooltip" data-bs-placement="bottom" onclick="document.body.setAttribute('data-bs-theme', 'light')">
                                <i class="ti ti-sun"></i>
                            </a>
                        </div>
                    </div>
                    
                    <!-- User menu -->
                    <div class="nav-item dropdown">
                        <a href="#" class="nav-link d-flex lh-1 text-reset p-0" data-bs-toggle="dropdown">
                            <span class="avatar avatar-sm" style="background-image: url(https://eu.ui-avatars.com/api/?name=Paul+Martin&background=c44569&color=fff)"></span>
                            <div class="d-none d-xl-block ps-2">
                                <div>Paul Martin</div>
                                <div class="mt-1 small text-secondary">
                                    <span class="badge bg-red">SUPERADMIN</span>
                                </div>
                            </div>
                        </a>
                        <div class="dropdown-menu dropdown-menu-end dropdown-menu-arrow">
                            <a href="#" class="dropdown-item">Mon Profil</a>
                            <a href="../2fa-setup.html" class="dropdown-item">Paramètres 2FA</a>
                            <div class="dropdown-divider"></div>
                            <a href="../../logout.html" class="dropdown-item">Déconnexion</a>
                        </div>
                    </div>
                </div>
            </div>
        </header>
        
        <!-- Page content -->
        <div class="page-wrapper">
            <div class="page-header d-print-none">
                <div class="container-xl">
                    <div class="row g-2 align-items-center">
                        <div class="col">
                            <nav aria-label="breadcrumb">
                                <ol class="breadcrumb">
                                    <li class="breadcrumb-item"><a href="../dashboard.html">Dashboard</a></li>
                                    <li class="breadcrumb-item"><a href="#">Finance</a></li>
                                    <li class="breadcrumb-item active">Factures Fournisseurs</li>
                                </ol>
                            </nav>
                            <h2 class="page-title">
                                <span class="text-primary me-2">
                                    <i class="ti ti-file-invoice"></i>
                                </span>
                                Factures Fournisseurs
                            </h2>
                            <div class="text-muted">
                                Gestion complète du workflow de validation et paiement
                            </div>
                        </div>
                        <div class="col-auto ms-auto d-print-none">
                            <div class="btn-list">
                                <button class="btn ocr-import-btn" id="import-from-ocr" data-permission="superadmin.finance.create">
                                    <i class="ti ti-scan text-warning"></i>
                                    Import OCR
                                </button>
                                <button class="btn" id="export-invoices" data-permission="superadmin.finance.export">
                                    <i class="ti ti-download"></i>
                                    Export
                                </button>
                                <button class="btn btn-warning" id="batch-payments" data-permission="superadmin.finance.pay">
                                    <i class="ti ti-cash"></i>
                                    Paiements
                                </button>
                                <button class="btn btn-primary" id="new-invoice" data-permission="superadmin.finance.create">
                                    <i class="ti ti-plus"></i>
                                    Nouvelle Facture
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="page-body">
                <div class="container-xl">
                    <!-- Stats Cards -->
                    <div class="row row-deck row-cards mb-4">
                        <div class="col-sm-6 col-lg-3">
                            <div class="card card-sm">
                                <div class="card-stamp">
                                    <div class="card-stamp-icon bg-yellow">
                                        <i class="ti ti-clock"></i>
                                    </div>
                                </div>
                                <div class="card-body">
                                    <div class="row align-items-center">
                                        <div class="col-auto">
                                            <span class="bg-yellow text-white avatar">
                                                <i class="ti ti-clock"></i>
                                            </span>
                                        </div>
                                        <div class="col">
                                            <div class="text-uppercase text-secondary small font-weight-medium">En attente</div>
                                            <div class="h1 mb-0 metric-value" id="total-pending">CHF 0</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-6 col-lg-3">
                            <div class="card card-sm">
                                <div class="card-stamp">
                                    <div class="card-stamp-icon bg-azure">
                                        <i class="ti ti-check"></i>
                                    </div>
                                </div>
                                <div class="card-body">
                                    <div class="row align-items-center">
                                        <div class="col-auto">
                                            <span class="bg-azure text-white avatar">
                                                <i class="ti ti-check"></i>
                                            </span>
                                        </div>
                                        <div class="col">
                                            <div class="text-uppercase text-secondary small font-weight-medium">Validées</div>
                                            <div class="h1 mb-0 metric-value" id="total-validated">CHF 0</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-6 col-lg-3">
                            <div class="card card-sm">
                                <div class="card-stamp">
                                    <div class="card-stamp-icon bg-green">
                                        <i class="ti ti-cash"></i>
                                    </div>
                                </div>
                                <div class="card-body">
                                    <div class="row align-items-center">
                                        <div class="col-auto">
                                            <span class="bg-green text-white avatar">
                                                <i class="ti ti-cash"></i>
                                            </span>
                                        </div>
                                        <div class="col">
                                            <div class="text-uppercase text-secondary small font-weight-medium">Payées ce mois</div>
                                            <div class="h1 mb-0 metric-value" id="total-paid">CHF 0</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-6 col-lg-3">
                            <div class="card card-sm">
                                <div class="card-stamp">
                                    <div class="card-stamp-icon bg-red">
                                        <i class="ti ti-alert-triangle"></i>
                                    </div>
                                </div>
                                <div class="card-body">
                                    <div class="row align-items-center">
                                        <div class="col-auto">
                                            <span class="bg-red text-white avatar">
                                                <i class="ti ti-alert-triangle"></i>
                                            </span>
                                        </div>
                                        <div class="col">
                                            <div class="text-uppercase text-secondary small font-weight-medium">En retard</div>
                                            <div class="h1 mb-0 text-danger metric-value" id="total-overdue">CHF 0</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Filtres -->
                    <div class="card mb-4">
                        <div class="card-body">
                        <div class="filter-group">
                            <div class="filter-item">
                                <label class="form-label small mb-1">Statut</label>
                                <select class="form-select form-select-sm" id="filter-status">
                                    <option value="">Tous les statuts</option>
                                    <option value="draft">Brouillon</option>
                                    <option value="pending_validation">À valider</option>
                                    <option value="validated">Validée</option>
                                    <option value="paid">Payée</option>
                                    <option value="dispute">Litige</option>
                                    <option value="overdue">En retard</option>
                                </select>
                            </div>
                            <div class="filter-item">
                                <label class="form-label small mb-1">Entité</label>
                                <select class="form-select form-select-sm" id="filter-entity">
                                    <option value="">Toutes les entités</option>
                                    <option value="hypervisual">Hypervisual</option>
                                    <option value="dainamics">Dainamics</option>
                                    <option value="waveform">Waveform</option>
                                    <option value="particule">Particule</option>
                                    <option value="holding">Swiss Digital Holding</option>
                                </select>
                            </div>
                            <div class="filter-item">
                                <label class="form-label small mb-1">Fournisseur</label>
                                <select class="form-select form-select-sm" id="filter-supplier">
                                    <option value="">Tous les fournisseurs</option>
                                    <!-- Sera peuplé dynamiquement -->
                                </select>
                            </div>
                            <div class="filter-item">
                                <label class="form-label small mb-1">Échéance</label>
                                <select class="form-select form-select-sm" id="filter-due">
                                    <option value="">Toutes</option>
                                    <option value="overdue">En retard</option>
                                    <option value="today">Aujourd'hui</option>
                                    <option value="week">Cette semaine</option>
                                    <option value="month">Ce mois</option>
                                </select>
                            </div>
                            <div class="filter-item">
                                <button class="btn btn-sm btn-outline-secondary" id="clear-filters" style="margin-top: 1.5rem;">
                                    <i class="ti ti-refresh"></i>
                                    Reset
                                </button>
                            </div>
                        </div>
                        </div>
                    </div>
                    
                    <!-- Alertes échéances -->
                    <div id="due-alerts"></div>
                    
                    <!-- Table factures -->
                    <div class="card">
                        <div class="card-status-top bg-primary"></div>
                        <div class="card-header">
                            <h3 class="card-title">
                                <span id="invoices-count">0</span> facture(s) fournisseur
                            </h3>
                            <div class="card-actions">
                                <div class="dropdown">
                                    <button class="btn btn-sm dropdown-toggle" data-bs-toggle="dropdown">
                                        Actions groupées
                                    </button>
                                    <div class="dropdown-menu">
                                        <a class="dropdown-item" href="#" id="bulk-validate">
                                            <i class="ti ti-check me-2"></i>
                                            Valider sélection
                                        </a>
                                        <a class="dropdown-item" href="#" id="bulk-pay">
                                            <i class="ti ti-cash me-2"></i>
                                            Programmer paiement
                                        </a>
                                        <a class="dropdown-item" href="#" id="bulk-export">
                                            <i class="ti ti-download me-2"></i>
                                            Exporter sélection
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="table-responsive">
                            <table class="table table-vcenter table-striped" id="invoices-table">
                                <thead>
                                    <tr>
                                        <th class="w-1">
                                            <input class="form-check-input" type="checkbox" id="select-all">
                                        </th>
                                        <th>N° Facture</th>
                                        <th>Fournisseur</th>
                                        <th>Entité</th>
                                        <th class="text-end">Montant</th>
                                        <th>Date facture</th>
                                        <th>Échéance</th>
                                        <th>Statut</th>
                                        <th>Validation</th>
                                        <th class="w-1">Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Sera peuplé par JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            
            <footer class="footer footer-transparent d-print-none">
                <div class="container-xl">
                    <div class="row text-center align-items-center flex-row-reverse">
                        <div class="col-lg-auto ms-lg-auto">
                            <ul class="list-inline list-inline-dots mb-0">
                                <li class="list-inline-item"><a href="../system/audit-logs.html" class="link-secondary">Logs d'audit</a></li>
                                <li class="list-inline-item"><a href="../system/settings.html" class="link-secondary">Configuration</a></li>
                            </ul>
                        </div>
                        <div class="col-12 col-lg-auto mt-3 mt-lg-0">
                            <ul class="list-inline list-inline-dots mb-0">
                                <li class="list-inline-item">
                                    Copyright &copy; 2025
                                    <a href=".." class="link-secondary">Dashboard Groupe</a>.
                                    Tous droits réservés.
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </footer>
        </div>
    </div>
    
    <!-- Modals -->
    
    <!-- Modal nouvelle facture -->
    <div class="modal modal-blur fade" id="newInvoiceModal" tabindex="-1" role="dialog">
        <div class="modal-dialog modal-xl modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Nouvelle facture fournisseur</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="newInvoiceForm">
                        <div class="row">
                            <div class="col-md-6">
                                <h4 class="mb-3">Informations fournisseur</h4>
                                
                                <div class="mb-3">
                                    <label class="form-label">Fournisseur</label>
                                    <div class="input-group">
                                        <input type="text" class="form-control" id="supplier-name" placeholder="Nom du fournisseur" required>
                                        <button class="btn btn-outline-secondary" type="button" id="search-supplier">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none">
                                                <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                                <path d="M10 10m-7 0a7 7 0 1 0 14 0a7 7 0 1 0 -14 0" />
                                                <path d="M21 21l-6 -6" />
                                            </svg>
                                        </button>
                                    </div>
                                </div>
                                
                                <div class="mb-3">
                                    <label class="form-label">N° TVA</label>
                                    <input type="text" class="form-control" id="supplier-vat" placeholder="CHE-XXX.XXX.XXX">
                                </div>
                                
                                <div class="mb-3">
                                    <label class="form-label">IBAN</label>
                                    <input type="text" class="form-control" id="supplier-iban" placeholder="CH00 0000 0000 0000 0000 0">
                                </div>
                                
                                <div class="mb-3">
                                    <label class="form-label">Adresse</label>
                                    <textarea class="form-control" id="supplier-address" rows="3" placeholder="Adresse complète"></textarea>
                                </div>
                            </div>
                            
                            <div class="col-md-6">
                                <h4 class="mb-3">Détails facture</h4>
                                
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label class="form-label">N° Facture</label>
                                            <input type="text" class="form-control" id="invoice-number" required>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label class="form-label">Date facture</label>
                                            <input type="date" class="form-control" id="invoice-date" required>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label class="form-label">Date échéance</label>
                                            <input type="date" class="form-control" id="due-date" required>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label class="form-label">Entité</label>
                                            <select class="form-select" id="invoice-entity" required>
                                                <option value="">Sélectionner...</option>
                                                <option value="hypervisual">Hypervisual</option>
                                                <option value="dainamics">Dainamics</option>
                                                <option value="waveform">Waveform</option>
                                                <option value="particule">Particule</option>
                                                <option value="holding">Swiss Digital Holding</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="mb-3">
                                    <label class="form-label">Catégorie</label>
                                    <select class="form-select" id="invoice-category">
                                        <option value="">Sélectionner...</option>
                                        <option value="services">Services</option>
                                        <option value="consulting">Consulting</option>
                                        <option value="material">Matériel</option>
                                        <option value="software">Logiciels</option>
                                        <option value="marketing">Marketing</option>
                                        <option value="travel">Déplacement</option>
                                        <option value="office">Bureau</option>
                                        <option value="other">Autre</option>
                                    </select>
                                </div>
                                
                                <div class="row">
                                    <div class="col-md-4">
                                        <div class="mb-3">
                                            <label class="form-label">Montant HT</label>
                                            <div class="input-group">
                                                <span class="input-group-text">CHF</span>
                                                <input type="number" class="form-control" id="amount-ht" step="0.01" required>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="mb-3">
                                            <label class="form-label">TVA</label>
                                            <div class="input-group">
                                                <span class="input-group-text">CHF</span>
                                                <input type="number" class="form-control" id="amount-vat" step="0.01">
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="mb-3">
                                            <label class="form-label">Total TTC</label>
                                            <div class="input-group">
                                                <span class="input-group-text">CHF</span>
                                                <input type="number" class="form-control" id="amount-total" step="0.01" readonly>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="mb-3">
                                    <label class="form-label">Notes</label>
                                    <textarea class="form-control" id="invoice-notes" rows="2" placeholder="Notes ou commentaires..."></textarea>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn" data-bs-dismiss="modal">Annuler</button>
                    <button type="button" class="btn btn-secondary" id="save-draft">Sauver brouillon</button>
                    <button type="button" class="btn btn-primary" id="save-invoice">Créer facture</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal détails facture -->
    <div class="modal modal-blur fade" id="invoiceDetailsModal" tabindex="-1" role="dialog">
        <div class="modal-dialog modal-xl modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Détails facture</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="invoice-details-content">
                    <!-- Contenu chargé dynamiquement -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn" data-bs-dismiss="modal">Fermer</button>
                    <button type="button" class="btn btn-warning" id="edit-invoice">Modifier</button>
                    <button type="button" class="btn btn-success" id="validate-invoice" style="display: none;">Valider</button>
                    <button type="button" class="btn btn-primary" id="pay-invoice" style="display: none;">Programmer paiement</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal import OCR -->
    <div class="modal modal-blur fade" id="ocrImportModal" tabindex="-1" role="dialog">
        <div class="modal-dialog modal-lg modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Import depuis OCR</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div id="ocr-documents-list">
                        <!-- Liste des documents OCR traités -->
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn" data-bs-dismiss="modal">Fermer</button>
                    <button type="button" class="btn btn-primary" onclick="window.location.href='../documents/ocr-intelligent.html'">
                        Traiter nouveaux documents
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Toast Container -->
    <div class="toast-container position-fixed bottom-0 end-0 p-3"></div>
    
    <!-- JS Tabler -->
    <script src="https://cdn.jsdelivr.net/npm/@tabler/core@latest/dist/js/tabler.min.js"></script>
    
    <!-- jQuery (required for DataTables) -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    
    <!-- DataTables -->
    <script src="https://cdn.datatables.net/1.13.7/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.7/js/dataTables.bootstrap5.min.js"></script>
    
    <!-- App Core -->
    <script src="../../assets/js/app.js"></script>
    <script src="../../assets/js/auth-notion.js"></script>
    <script src="../../assets/js/permissions-notion.js"></script>
    
    <!-- Modules Superadmin -->
    <script src="../../assets/js/auth-superadmin.js"></script>
    <script src="../../assets/js/permissions-superadmin.js"></script>
    <script src="../../assets/js/invoices-in-notion.js"></script>
    
    <script>
        document.addEventListener('DOMContentLoaded', async function() {
            // Vérifications sécurité
            if (!window.AuthSuperadmin.isAuthenticated() || !window.AuthSuperadmin.isTwoFactorVerified()) {
                window.location.href = '/portal-project/superadmin/2fa-verify.html';
                return;
            }
            
            // Vérifier permission factures
            if (!await window.PermissionsSuperadmin.hasPermission('superadmin.finance.view')) {
                alert('Accès refusé : permissions insuffisantes');
                window.location.href = '/portal-project/superadmin/dashboard.html';
                return;
            }
            
            // Logger accès
            await window.AuthSuperadmin.logAuditEvent('INVOICES_IN_ACCESS', {
                page: 'invoices_in'
            });
            
            // Charger navigation
            await loadNavigation();
            
            // Initialiser module factures
            if (window.InvoicesInNotion) {
                await window.InvoicesInNotion.init();
            }
            
            console.log('Factures fournisseurs chargées avec succès');
        });
        
        // Charger navigation dynamique
        async function loadNavigation() {
            const sidebar = document.querySelector('#sidebar-menu .navbar-nav');
            if (!sidebar) return;
            
            const navHTML = `
                <li class="nav-item">
                    <a class="nav-link" href="../dashboard.html">
                        <span class="nav-link-icon d-md-none d-lg-inline-block">
                            <i class="ti ti-home"></i>
                        </span>
                        <span class="nav-link-title">Dashboard Consolidé</span>
                    </a>
                </li>
                
                <li class="nav-item dropdown active">
                    <a class="nav-link dropdown-toggle" href="#navbar-finance" data-bs-toggle="dropdown" data-bs-auto-close="false" role="button" aria-expanded="true">
                        <span class="nav-link-icon d-md-none d-lg-inline-block">
                            <i class="ti ti-businessplan"></i>
                        </span>
                        <span class="nav-link-title">Finance & Comptabilité</span>
                    </a>
                    <div class="dropdown-menu show">
                        <div class="dropdown-menu-columns">
                            <div class="dropdown-menu-column">
                                <a class="dropdown-item" href="./ocr-upload.html">
                                    <span class="nav-link-icon d-md-none d-lg-inline-block text-warning">
                                        <i class="ti ti-scan"></i>
                                    </span>
                                    Centre OCR
                                </a>
                                <a class="dropdown-item active" href="./invoices-in.html">Factures Fournisseurs</a>
                                <a class="dropdown-item" href="./invoices-out.html">Factures Clients</a>
                                <a class="dropdown-item" href="./expenses.html">Notes de Frais</a>
                                <a class="dropdown-item" href="./banking.html">Banking Revolut</a>
                                <a class="dropdown-item" href="./accounting.html">Comptabilité</a>
                                <a class="dropdown-item" href="./vat-reports.html">Déclarations TVA</a>
                                <a class="dropdown-item" href="./monthly-reports.html">Bilans Mensuels</a>
                            </div>
                        </div>
                    </div>
                </li>
            `;
            
            sidebar.innerHTML = navHTML;
        }
    </script>
</body>
</html>