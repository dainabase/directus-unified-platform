<!doctype html>
<html lang="fr">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
    <meta http-equiv="X-UA-Compatible" content="ie=edge"/>
    <title>Projets Multi-Entit√©s - SuperAdmin Dashboard</title>
    <!-- CSS files -->
    <link href="https://cdn.jsdelivr.net/npm/@tabler/core@1.0.0-beta20/dist/css/tabler.min.css" rel="stylesheet"/>
    <link href="https://cdn.jsdelivr.net/npm/@tabler/icons@latest/icons-sprite.svg" rel="stylesheet"/>
    <link href="../../assets/css/custom.css" rel="stylesheet"/>
    
    <!-- DataTables CSS -->
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.13.4/css/dataTables.bootstrap5.min.css"/>
    
    <!-- dhtmlxGantt CSS -->
    <link rel="stylesheet" href="https://cdn.dhtmlx.com/gantt/edge/dhtmlxgantt.css" type="text/css">
    
    <!-- SortableJS pour Kanban -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.css">
    
    <!-- ApexCharts pour graphiques budget -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/apexcharts@latest/dist/apexcharts.css">
    
    <style>
        .role-superadmin { --tblr-primary: #2563eb; }
        .project-card { transition: all 0.3s ease; }
        .project-card:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.15); }
        .entity-badge { font-size: 0.75rem; padding: 0.25rem 0.5rem; }
        .health-score-excellent { background: #22c55e; color: white; }
        .health-score-good { background: #84cc16; color: white; }
        .health-score-warning { background: #f59e0b; color: white; }
        .health-score-critical { background: #ef4444; color: white; }
        .progress-bar-custom { height: 8px; border-radius: 4px; }
        .kanban-column { min-height: 600px; background: #f8fafc; border-radius: 8px; padding: 1rem; }
        .kanban-card { background: white; border-radius: 6px; padding: 1rem; margin-bottom: 0.75rem; cursor: move; }
        .gantt-container { height: 500px; border: 1px solid #e2e8f0; border-radius: 8px; }
        .resource-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1rem; }
        .resource-card { background: white; border: 1px solid #e2e8f0; border-radius: 8px; padding: 1rem; }
        .budget-chart-container { height: 400px; }
        .filter-section { background: #f8fafc; border-radius: 8px; padding: 1.5rem; margin-bottom: 2rem; }
        .quick-stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 2rem; }
        .stat-card { background: white; border: 1px solid #e2e8f0; border-radius: 8px; padding: 1.5rem; text-align: center; }
        .view-tabs { border-bottom: 2px solid #e2e8f0; margin-bottom: 2rem; }
        .view-tab { padding: 0.75rem 1.5rem; cursor: pointer; border-bottom: 3px solid transparent; transition: all 0.3s; }
        .view-tab.active { border-bottom-color: var(--tblr-primary); color: var(--tblr-primary); font-weight: 600; }
        .view-tab:hover { background: #f1f5f9; }
        .entity-filter-badge { cursor: pointer; transition: all 0.3s; }
        .entity-filter-badge.active { transform: scale(1.05); box-shadow: 0 2px 8px rgba(0,0,0,0.2); }
    </style>
</head>
<body class="layout-fluid role-superadmin">
    <script src="../../assets/js/demo-theme.js?1692870487"></script>
    
    <div class="page">
        <!-- Navbar -->
        <div id="navbar-container"></div>

        <!-- Sidebar -->
        <div id="sidebar-container"></div>

        <div class="page-wrapper">
            <!-- Page header -->
            <div class="page-header d-print-none">
                <div class="container-xl">
                    <div class="row g-2 align-items-center">
                        <div class="col">
                            <div class="page-pretitle">
                                SuperAdmin Dashboard
                            </div>
                            <h2 class="page-title">
                                üìä Projets Multi-Entit√©s
                            </h2>
                            <div class="page-subtitle">
                                Vue consolid√©e de tous les projets actifs
                            </div>
                        </div>
                        <div class="col-auto ms-auto d-print-none">
                            <div class="btn-list">
                                <button type="button" class="btn btn-primary" id="btn-refresh-data">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                        <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                        <path d="M20 11a8.1 8.1 0 0 0 -15.5 -2m-.5 -4v4h4"/>
                                        <path d="M4 13a8.1 8.1 0 0 0 15.5 2m.5 4v-4h-4"/>
                                    </svg>
                                    Actualiser
                                </button>
                                <div class="dropdown">
                                    <button class="btn btn-outline-primary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                            <path d="M14 3v4a1 1 0 0 0 1 1h4"/>
                                            <path d="M17 21h-10a2 2 0 0 1 -2 -2v-14a2 2 0 0 1 2 -2h7l5 5v11a2 2 0 0 1 -2 2z"/>
                                        </svg>
                                        Exporter
                                    </button>
                                    <ul class="dropdown-menu">
                                        <li><a class="dropdown-item" href="#" id="export-excel">Excel (.xlsx)</a></li>
                                        <li><a class="dropdown-item" href="#" id="export-csv">CSV</a></li>
                                        <li><a class="dropdown-item" href="#" id="export-pdf">PDF</a></li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Page body -->
            <div class="page-body">
                <div class="container-xl">
                    
                    <!-- Statistiques rapides -->
                    <div class="quick-stats">
                        <div class="stat-card">
                            <div class="h1 text-primary mb-1" id="total-projects">-</div>
                            <div class="text-muted">Projets Actifs</div>
                        </div>
                        <div class="stat-card">
                            <div class="h1 text-success mb-1" id="total-budget">-</div>
                            <div class="text-muted">Budget Total</div>
                        </div>
                        <div class="stat-card">
                            <div class="h1 text-info mb-1" id="avg-progress">-</div>
                            <div class="text-muted">Avancement Moyen</div>
                        </div>
                        <div class="stat-card">
                            <div class="h1 text-warning mb-1" id="at-risk-projects">-</div>
                            <div class="text-muted">Projets √† Risque</div>
                        </div>
                    </div>

                    <!-- Section de filtres -->
                    <div class="filter-section">
                        <div class="row">
                            <div class="col-md-3">
                                <label class="form-label">Entit√© du Groupe</label>
                                <div class="d-flex flex-wrap gap-2" id="entity-filters">
                                    <span class="badge entity-filter-badge bg-primary active" data-entity="all">Toutes</span>
                                    <span class="badge entity-filter-badge bg-secondary" data-entity="hypervisual">Hypervisual</span>
                                    <span class="badge entity-filter-badge bg-info" data-entity="dainamics">Dainamics</span>
                                    <span class="badge entity-filter-badge bg-success" data-entity="enki">Enki Reality</span>
                                    <span class="badge entity-filter-badge bg-warning" data-entity="takeout">Take Out</span>
                                    <span class="badge entity-filter-badge bg-danger" data-entity="lexaia">Lexaia</span>
                                </div>
                            </div>
                            <div class="col-md-2">
                                <label class="form-label">Statut Projet</label>
                                <select class="form-select" id="filter-status">
                                    <option value="">Tous</option>
                                    <option value="En planification">En planification</option>
                                    <option value="En cours">En cours</option>
                                    <option value="En r√©vision">En r√©vision</option>
                                    <option value="Termin√©">Termin√©</option>
                                    <option value="En pause">En pause</option>
                                    <option value="Annul√©">Annul√©</option>
                                </select>
                            </div>
                            <div class="col-md-2">
                                <label class="form-label">Priorit√©</label>
                                <select class="form-select" id="filter-priority">
                                    <option value="">Toutes</option>
                                    <option value="Critique">Critique</option>
                                    <option value="√âlev√©e">√âlev√©e</option>
                                    <option value="Normale">Normale</option>
                                    <option value="Faible">Faible</option>
                                </select>
                            </div>
                            <div class="col-md-2">
                                <label class="form-label">Health Score</label>
                                <select class="form-select" id="filter-health">
                                    <option value="">Tous</option>
                                    <option value="90-100">Excellent (90-100)</option>
                                    <option value="70-89">Bon (70-89)</option>
                                    <option value="50-69">Attention (50-69)</option>
                                    <option value="0-49">Critique (0-49)</option>
                                </select>
                            </div>
                            <div class="col-md-3">
                                <label class="form-label">Recherche</label>
                                <input type="text" class="form-control" id="search-projects" placeholder="Nom du projet, client...">
                            </div>
                        </div>
                    </div>

                    <!-- Onglets de vues -->
                    <div class="view-tabs d-flex">
                        <div class="view-tab active" data-view="list">
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon me-1" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                <path d="M9 6l11 0"/>
                                <path d="M9 12l11 0"/>
                                <path d="M9 18l11 0"/>
                                <path d="M5 6l0 .01"/>
                                <path d="M5 12l0 .01"/>
                                <path d="M5 18l0 .01"/>
                            </svg>
                            Liste
                        </div>
                        <div class="view-tab" data-view="kanban">
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon me-1" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                <path d="M4 4h6v8h-6z"/>
                                <path d="M14 4h6v12h-6z"/>
                                <path d="M4 16h6v4h-6z"/>
                            </svg>
                            Kanban
                        </div>
                        <div class="view-tab" data-view="gantt">
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon me-1" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                <path d="M3 7l18 0"/>
                                <path d="M3 17l18 0"/>
                                <path d="M8 7v10"/>
                                <path d="M16 7v10"/>
                            </svg>
                            Gantt
                        </div>
                        <div class="view-tab" data-view="resources">
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon me-1" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                <path d="M9 7m-4 0a4 4 0 1 0 8 0a4 4 0 1 0 -8 0"/>
                                <path d="M3 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2"/>
                                <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
                                <path d="M21 21v-2a4 4 0 0 0 -3 -3.85"/>
                            </svg>
                            Ressources
                        </div>
                        <div class="view-tab" data-view="budget">
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon me-1" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                <path d="M17 8v-3a1 1 0 0 0 -1 -1h-10a2 2 0 0 0 0 4h12a1 1 0 0 1 1 1v3m0 4v3a1 1 0 0 1 -1 1h-12a2 2 0 0 1 -2 -2v-12"/>
                                <path d="M20 12v4h-4a2 2 0 0 1 0 -4h4"/>
                            </svg>
                            Budget
                        </div>
                    </div>

                    <!-- Vue Liste -->
                    <div class="view-content" id="view-list">
                        <div class="card">
                            <div class="table-responsive">
                                <table class="table table-vcenter card-table" id="projects-table">
                                    <thead>
                                        <tr>
                                            <th>Projet</th>
                                            <th>Client</th>
                                            <th>Entit√©</th>
                                            <th>Statut</th>
                                            <th>Avancement</th>
                                            <th>Health Score</th>
                                            <th>Budget</th>
                                            <th>Dates</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="projects-list-body">
                                        <!-- Donn√©es charg√©es via JavaScript -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- Vue Kanban -->
                    <div class="view-content" id="view-kanban" style="display: none;">
                        <div class="row" id="kanban-board">
                            <!-- Colonnes g√©n√©r√©es dynamiquement -->
                        </div>
                    </div>

                    <!-- Vue Gantt -->
                    <div class="view-content" id="view-gantt" style="display: none;">
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">Timeline des Projets</h3>
                                <div class="card-actions">
                                    <button class="btn btn-sm btn-outline-primary" id="gantt-zoom-in">Zoom +</button>
                                    <button class="btn btn-sm btn-outline-primary" id="gantt-zoom-out">Zoom -</button>
                                </div>
                            </div>
                            <div class="card-body">
                                <div id="gantt-container" class="gantt-container"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Vue Ressources -->
                    <div class="view-content" id="view-resources" style="display: none;">
                        <div class="resource-grid" id="resources-grid">
                            <!-- Cartes de ressources g√©n√©r√©es dynamiquement -->
                        </div>
                    </div>

                    <!-- Vue Budget -->
                    <div class="view-content" id="view-budget" style="display: none;">
                        <div class="row">
                            <div class="col-lg-8">
                                <div class="card">
                                    <div class="card-header">
                                        <h3 class="card-title">Budget vs R√©alis√© par Entit√©</h3>
                                    </div>
                                    <div class="card-body">
                                        <div id="budget-chart" class="budget-chart-container"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-4">
                                <div class="card">
                                    <div class="card-header">
                                        <h3 class="card-title">R√©partition Budget</h3>
                                    </div>
                                    <div class="card-body">
                                        <div id="budget-pie-chart" style="height: 350px;"></div>
                                    </div>
                                </div>
                                <div class="card mt-3">
                                    <div class="card-header">
                                        <h3 class="card-title">M√©triques Financi√®res</h3>
                                    </div>
                                    <div class="card-body">
                                        <div class="d-flex justify-content-between mb-2">
                                            <span>Budget Total</span>
                                            <strong id="budget-total">CHF 0</strong>
                                        </div>
                                        <div class="d-flex justify-content-between mb-2">
                                            <span>Factur√©</span>
                                            <strong id="budget-invoiced">CHF 0</strong>
                                        </div>
                                        <div class="d-flex justify-content-between mb-2">
                                            <span>Marge Estim√©e</span>
                                            <strong id="budget-margin">0%</strong>
                                        </div>
                                        <div class="d-flex justify-content-between">
                                            <span>ROI Pr√©visionnel</span>
                                            <strong id="budget-roi">0%</strong>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loading-overlay" class="position-fixed top-0 start-0 w-100 h-100 d-flex align-items-center justify-content-center" style="background: rgba(255,255,255,0.9); z-index: 9999; display: none !important;">
        <div class="text-center">
            <div class="spinner-border text-primary mb-3" role="status">
                <span class="visually-hidden">Chargement...</span>
            </div>
            <div class="h5">Chargement des projets...</div>
        </div>
    </div>

    <!-- Modal D√©tails Projet -->
    <div class="modal fade" id="project-details-modal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">D√©tails du Projet</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" id="project-details-content">
                    <!-- Contenu charg√© dynamiquement -->
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/@tabler/core@1.0.0-beta20/dist/js/tabler.min.js"></script>
    <script src="../../assets/js/app.js"></script>
    
    <!-- DataTables -->
    <script type="text/javascript" src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/1.13.4/js/dataTables.bootstrap5.min.js"></script>
    
    <!-- dhtmlxGantt -->
    <script src="https://cdn.dhtmlx.com/gantt/edge/dhtmlxgantt.js"></script>
    
    <!-- SortableJS -->
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>
    
    <!-- ApexCharts -->
    <script src="https://cdn.jsdelivr.net/npm/apexcharts@latest/dist/apexcharts.min.js"></script>
    
    <!-- Wrapper Notion MCP -->
    <script src="../../assets/js/mcp-notion-wrapper.js"></script>
    
    <!-- Module Projets SuperAdmin -->
    <script src="../../assets/js/Superadmin/projects-admin-superadmin.js"></script>

    <script>
        // Initialisation lors du chargement
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof window.ProjectsAdminSuperAdmin !== 'undefined') {
                window.ProjectsAdminSuperAdmin.init();
            } else {
                console.error('Module ProjectsAdminSuperAdmin non trouv√©');
            }
        });
    </script>
</body>
</html>