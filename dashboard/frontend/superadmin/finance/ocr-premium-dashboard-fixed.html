<!doctype html>
<html lang="fr">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
    <meta http-equiv="X-UA-Compatible" content="ie=edge"/>
    <title>Vision AI - Traitement intelligent de documents</title>
    
    <!-- CSS Files -->
    <link href="https://cdn.jsdelivr.net/npm/@tabler/core@1.0.0-beta20/dist/css/tabler.min.css" rel="stylesheet"/>
    <link href="https://cdn.jsdelivr.net/npm/@tabler/core@1.0.0-beta20/dist/css/tabler-flags.min.css" rel="stylesheet"/>
    <link href="https://cdn.jsdelivr.net/npm/@tabler/core@1.0.0-beta20/dist/css/tabler-payments.min.css" rel="stylesheet"/>
    <link href="https://cdn.jsdelivr.net/npm/@tabler/core@1.0.0-beta20/dist/css/tabler-vendors.min.css" rel="stylesheet"/>
    
    <!-- Tabler Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@tabler/icons@latest/iconfont/tabler-icons.min.css">
    
    <style>
      @import url('https://rsms.me/inter/inter.css');
      :root {
      	--tblr-font-sans-serif: 'Inter Var', -apple-system, BlinkMacSystemFont, San Francisco, Segoe UI, Roboto, Helvetica Neue, sans-serif;
      }
      body {
      	font-feature-settings: "cv03", "cv04", "cv11";
      }
      
      /* Dark mode toggle visibility */
      [data-bs-theme="dark"] .hide-theme-dark { display: none !important; }
      [data-bs-theme="light"] .hide-theme-light { display: none !important; }
      
      /* Animations modernes */
      @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
      }
      
      @keyframes pulse {
        0%, 100% { transform: scale(1); opacity: 0.8; }
        50% { transform: scale(1.05); opacity: 1; }
      }
      
      @keyframes slideUp {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
      }
      
      @keyframes aiThinking {
        0% { transform: rotate(0deg); opacity: 0.8; }
        25% { transform: rotate(5deg); opacity: 1; }
        50% { transform: rotate(0deg); opacity: 0.8; }
        75% { transform: rotate(-5deg); opacity: 1; }
        100% { transform: rotate(0deg); opacity: 0.8; }
      }
      
      @keyframes progressShine {
        0% { left: -100%; }
        100% { left: 100%; }
      }
      
      .fade-in {
        animation: fadeIn 0.3s ease-out;
      }
      
      .slide-up {
        animation: slideUp 0.4s ease-out;
      }
      
      /* Dropzone moderne et belle */
      .dropzone-wrapper {
        position: relative;
        min-height: 300px;
        border: 3px dashed #206bc4;
        border-radius: 16px;
        background: linear-gradient(135deg, rgba(32, 107, 196, 0.02) 0%, rgba(32, 107, 196, 0.05) 100%);
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        cursor: pointer;
        overflow: hidden;
      }
      
      .dropzone-wrapper::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: radial-gradient(circle at center, transparent 0%, rgba(32, 107, 196, 0.03) 100%);
        opacity: 0;
        transition: opacity 0.3s ease;
      }
      
      .dropzone-wrapper:hover {
        border-color: #1a569d;
        background: linear-gradient(135deg, rgba(32, 107, 196, 0.05) 0%, rgba(32, 107, 196, 0.1) 100%);
        transform: translateY(-2px);
        box-shadow: 0 12px 24px -6px rgba(32, 107, 196, 0.15);
      }
      
      .dropzone-wrapper:hover::before {
        opacity: 1;
      }
      
      .dropzone-wrapper.drag-over {
        border-color: #2fb344;
        background: linear-gradient(135deg, rgba(47, 179, 68, 0.05) 0%, rgba(47, 179, 68, 0.1) 100%);
        transform: scale(1.02);
        box-shadow: 0 20px 40px -8px rgba(47, 179, 68, 0.2);
      }
      
      .dropzone-content {
        padding: 4rem 2rem;
        text-align: center;
        position: relative;
        z-index: 1;
      }
      
      .dropzone-icon {
        font-size: 5rem;
        color: #206bc4;
        opacity: 0.8;
        transition: all 0.3s ease;
        display: inline-block;
        margin-bottom: 1rem;
      }
      
      .dropzone-wrapper:hover .dropzone-icon {
        opacity: 1;
        transform: translateY(-8px) scale(1.1);
      }
      
      .dropzone-wrapper.drag-over .dropzone-icon {
        color: #2fb344;
        opacity: 1;
        animation: pulse 1s infinite;
      }
      
      /* Progress am√©lior√© avec animation */
      .progress-wrapper {
        position: relative;
        margin-top: 2rem;
      }
      
      .progress-details {
        display: flex;
        justify-content: space-between;
        margin-bottom: 0.75rem;
        font-size: 0.875rem;
        font-weight: 500;
      }
      
      .progress {
        height: 8px;
        background: var(--tblr-gray-200);
        border-radius: 4px;
        overflow: hidden;
        position: relative;
      }
      
      .progress-bar {
        background: linear-gradient(90deg, #206bc4 0%, #1a569d 100%);
        transition: width 0.3s ease;
        position: relative;
        overflow: hidden;
      }
      
      .progress-bar::after {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
        animation: progressShine 2s infinite;
      }
      
      .progress-bar-indeterminate {
        background-image: linear-gradient(
          45deg,
          rgba(255, 255, 255, 0.15) 25%,
          transparent 25%,
          transparent 50%,
          rgba(255, 255, 255, 0.15) 50%,
          rgba(255, 255, 255, 0.15) 75%,
          transparent 75%,
          transparent
        );
        background-size: 1rem 1rem;
        animation: progress-bar-stripes 1s linear infinite;
      }
      
      @keyframes progress-bar-stripes {
        0% { background-position: 0 0; }
        100% { background-position: 1rem 0; }
      }
      
      /* File preview am√©lior√© */
      .file-preview-card {
        transition: all 0.3s ease;
        opacity: 0;
        transform: translateY(10px);
      }
      
      .file-preview-card.show {
        opacity: 1;
        transform: translateY(0);
      }
      
      /* Stats cards modernes */
      .stat-card {
        background: var(--tblr-bg-surface);
        border: 1px solid var(--tblr-border-color);
        border-radius: 12px;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        overflow: hidden;
        position: relative;
      }
      
      .stat-card::before {
        content: '';
        position: absolute;
        top: 0;
        right: -50%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(32, 107, 196, 0.05));
        transform: skewX(-20deg);
        transition: right 0.5s ease;
      }
      
      .stat-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 12px 24px -6px rgba(0, 0, 0, 0.1);
        border-color: var(--tblr-primary);
      }
      
      .stat-card:hover::before {
        right: -20%;
      }
      
      .stat-card .card-body {
        position: relative;
        z-index: 1;
      }
      
      /* Ic√¥nes plus grandes dans les stats */
      .stat-card .icon {
        font-size: 2rem;
        opacity: 0.7;
      }
      
      /* Processing animation */
      .ai-processing {
        display: inline-block;
        animation: aiThinking 2s ease-in-out infinite;
      }
      
      .ai-processing-text {
        animation: pulse 2s ease-in-out infinite;
      }
      
      /* Sidebar moderne */
      .navbar-vertical {
        background: var(--tblr-bg-surface);
        border-right: 1px solid var(--tblr-border-color);
      }
      
      .navbar-vertical .navbar-brand {
        padding: 1.5rem 1rem;
      }
      
      .navbar-vertical .nav-link {
        color: var(--tblr-text-muted);
        padding: 0.75rem 1rem;
        border-radius: 8px;
        transition: all 0.2s ease;
      }
      
      .navbar-vertical .nav-link:hover {
        color: var(--tblr-primary);
        background: rgba(32, 107, 196, 0.05);
      }
      
      .navbar-vertical .nav-link.active {
        color: var(--tblr-primary);
        background: rgba(32, 107, 196, 0.1);
        font-weight: 500;
      }
      
      /* Header moderne */
      .navbar {
        background: var(--tblr-bg-surface);
        border-bottom: 1px solid var(--tblr-border-color);
        padding: 0.75rem 0;
      }
      
      /* Dropdown period selector */
      .period-selector {
        min-width: 140px;
      }
      
      .period-selector .dropdown-item.active {
        background: var(--tblr-primary);
        color: white;
      }
      
      /* Remove unwanted shadows */
      .card {
        box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
      }
      
      /* Better form controls */
      .form-control, .form-select {
        border-radius: 8px;
        border-color: var(--tblr-border-color);
        transition: all 0.2s ease;
      }
      
      .form-control:focus, .form-select:focus {
        border-color: var(--tblr-primary);
        box-shadow: 0 0 0 0.25rem rgba(32, 107, 196, 0.25);
      }
      
      /* Responsive adjustments */
      @media (max-width: 768px) {
        .dropzone-content {
          padding: 3rem 1.5rem;
        }
        
        .dropzone-icon {
          font-size: 4rem;
        }
        
        .stat-card {
          margin-bottom: 1rem;
        }
      }
    </style>
</head>
<body data-bs-theme="light">
    <div class="page">
        <!-- Header moderne -->
        <header class="navbar navbar-expand-md d-none d-lg-flex d-print-none">
            <div class="container-xl">
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar-menu">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <h1 class="navbar-brand navbar-brand-autodark d-none-navbar-horizontal pe-0 pe-md-3">
                    <a href="../dashboard.html">
                        <img src="../../assets/img/logo.svg" width="110" height="32" alt="Dashboard" class="navbar-brand-image">
                    </a>
                </h1>
                <div class="navbar-nav flex-row order-md-last">
                    <!-- Dark Mode Toggle moderne -->
                    <div class="nav-item d-none d-md-flex me-3">
                        <div class="btn-list-item">
                            <a href="#" class="nav-link px-0 hide-theme-dark" title="Enable dark mode" data-bs-toggle="tooltip" data-bs-placement="bottom" onclick="document.body.setAttribute('data-bs-theme', 'dark')">
                                <i class="ti ti-moon"></i>
                            </a>
                            <a href="#" class="nav-link px-0 hide-theme-light" title="Enable light mode" data-bs-toggle="tooltip" data-bs-placement="bottom" onclick="document.body.setAttribute('data-bs-theme', 'light')">
                                <i class="ti ti-sun"></i>
                            </a>
                        </div>
                    </div>
                    
                    <!-- User menu avec badge SUPERADMIN -->
                    <div class="nav-item dropdown">
                        <a href="#" class="nav-link d-flex lh-1 text-reset p-0" data-bs-toggle="dropdown">
                            <span class="avatar avatar-sm" style="background-image: url(https://eu.ui-avatars.com/api/?name=Paul+Martin&background=c44569&color=fff)"></span>
                            <div class="d-none d-xl-block ps-2">
                                <div>Paul Martin</div>
                                <div class="mt-1 small text-secondary">
                                    <span class="badge bg-red">SUPERADMIN</span>
                                </div>
                            </div>
                        </a>
                        <div class="dropdown-menu dropdown-menu-end dropdown-menu-arrow">
                            <a href="#" class="dropdown-item">Mon Profil</a>
                            <a href="../system/2fa-setup.html" class="dropdown-item">Param√®tres 2FA</a>
                            <div class="dropdown-divider"></div>
                            <a href="../../logout.html" class="dropdown-item">D√©connexion</a>
                        </div>
                    </div>
                </div>
            </div>
        </header>
        <!-- Page content -->
        <div class="page-wrapper">
            <div class="page-header d-print-none">
                <div class="container-xl">
                    <div class="row g-2 align-items-center">
                        <div class="col">
                            <div class="page-pretitle">Finance / Documents</div>
                            <h2 class="page-title">
                                <span class="text-primary me-2">
                                    <i class="ti ti-brain"></i>
                                </span>
                                Vision AI - Traitement intelligent
                            </h2>
                            <div class="text-muted">
                                Extraction automatique de donn√©es avec intelligence artificielle
                            </div>
                        </div>
                        <div class="col-auto ms-auto d-print-none">
                            <div class="btn-list">
                                <button class="btn" data-bs-toggle="modal" data-bs-target="#settings-modal">
                                    <i class="ti ti-settings"></i>
                                    Param√®tres
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="page-body">
                <div class="container-xl">
                    <!-- Period Selector -->
                    <div class="row mb-3">
                        <div class="col-12">
                            <div class="d-flex justify-content-between align-items-center">
                                <h3 class="mb-0">Statistiques</h3>
                                <div class="dropdown period-selector">
                                    <button class="btn btn-sm dropdown-toggle" data-bs-toggle="dropdown">
                                        <i class="ti ti-calendar me-2"></i>
                                        <span id="current-period">Aujourd'hui</span>
                                    </button>
                                    <div class="dropdown-menu dropdown-menu-end">
                                        <a class="dropdown-item active" href="#" data-period="today">Aujourd'hui</a>
                                        <a class="dropdown-item" href="#" data-period="week">Cette semaine</a>
                                        <a class="dropdown-item" href="#" data-period="month">Ce mois</a>
                                        <a class="dropdown-item" href="#" data-period="year">Cette ann√©e</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Stats Row avec ic√¥nes am√©lior√©es -->
                    <div class="row row-deck row-cards mb-4">
                        <div class="col-sm-6 col-lg-3 fade-in">
                            <div class="card stat-card">
                                <div class="card-body">
                                    <div class="row align-items-center">
                                        <div class="col-auto">
                                            <span class="bg-primary text-white avatar">
                                                <i class="ti ti-files icon"></i>
                                            </span>
                                        </div>
                                        <div class="col">
                                            <div class="subheader">Documents trait√©s</div>
                                            <div class="d-flex align-items-baseline">
                                                <div class="h1 mb-0 me-2" id="docs-count">0</div>
                                                <div class="me-auto">
                                                    <span class="text-green d-inline-flex align-items-center lh-1">
                                                        <i class="ti ti-trending-up"></i>
                                                        <span class="ms-1">+12%</span>
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-6 col-lg-3 fade-in" style="animation-delay: 0.1s">
                            <div class="card stat-card">
                                <div class="card-body">
                                    <div class="row align-items-center">
                                        <div class="col-auto">
                                            <span class="bg-success text-white avatar">
                                                <i class="ti ti-percentage icon"></i>
                                            </span>
                                        </div>
                                        <div class="col">
                                            <div class="subheader">Pr√©cision moyenne</div>
                                            <div class="h1 mb-2">98.5%</div>
                                            <div class="progress progress-sm">
                                                <div class="progress-bar bg-success" style="width: 98.5%" role="progressbar"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-6 col-lg-3 fade-in" style="animation-delay: 0.2s">
                            <div class="card stat-card">
                                <div class="card-body">
                                    <div class="row align-items-center">
                                        <div class="col-auto">
                                            <span class="bg-azure text-white avatar">
                                                <i class="ti ti-clock icon"></i>
                                            </span>
                                        </div>
                                        <div class="col">
                                            <div class="subheader">Temps moyen</div>
                                            <div class="h1 mb-0">2.8s</div>
                                            <div class="text-muted small">-0.5s vs hier</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-6 col-lg-3 fade-in" style="animation-delay: 0.3s">
                            <div class="card stat-card">
                                <div class="card-body">
                                    <div class="row align-items-center">
                                        <div class="col-auto">
                                            <span class="bg-purple text-white avatar">
                                                <i class="ti ti-robot icon"></i>
                                            </span>
                                        </div>
                                        <div class="col">
                                            <div class="subheader">Mod√®le IA actif</div>
                                            <div class="h3 mb-0">
                                                <span class="badge bg-purple-lt" id="model-badge">Vision AI</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Upload Section -->
                    <div class="row row-cards">
                        <div class="col-12">
                            <div class="card slide-up">
                                <div class="card-header">
                                    <h3 class="card-title">
                                        <i class="ti ti-cloud-upload text-primary me-2"></i>
                                        Upload de document
                                    </h3>
                                </div>
                                <div class="card-body">
                                    <div class="dropzone-wrapper" id="dropzone">
                                        <div class="dropzone-content">
                                            <i class="ti ti-file-upload dropzone-icon"></i>
                                            <h3 class="mt-4">Glissez votre document ici</h3>
                                            <p class="text-muted">ou cliquez pour s√©lectionner un fichier</p>
                                            <div class="mt-3">
                                                <span class="badge bg-secondary me-1">PDF</span>
                                                <span class="badge bg-secondary me-1">JPG</span>
                                                <span class="badge bg-secondary me-1">PNG</span>
                                                <span class="badge bg-secondary">WEBP</span>
                                                <span class="badge bg-secondary-lt ms-2">Max 20MB</span>
                                            </div>
                                        </div>
                                    </div>
                                    <input type="file" id="document-upload" class="d-none" accept=".pdf,.jpg,.jpeg,.png,.webp">
                                    
                                    <!-- File Preview -->
                                    <div class="file-preview-card mt-3 d-none" id="file-preview">
                                        <div class="d-flex align-items-center p-3 border rounded bg-gray-50">
                                            <span class="avatar bg-primary-lt">
                                                <i class="ti ti-file-text" id="file-icon"></i>
                                            </span>
                                            <div class="flex-fill ms-3">
                                                <div class="font-weight-medium" id="file-name"></div>
                                                <div class="text-muted small" id="file-size"></div>
                                            </div>
                                            <button class="btn btn-ghost-danger btn-icon" id="remove-file">
                                                <i class="ti ti-x"></i>
                                            </button>
                                        </div>
                                    </div>
                                    
                                    <!-- Progress avec animation IA -->
                                    <div class="progress-wrapper d-none" id="upload-progress">
                                        <div class="text-center mb-3">
                                            <div class="avatar avatar-xl bg-primary-lt mb-3 ai-processing">
                                                <i class="ti ti-brain"></i>
                                            </div>
                                            <h4 class="ai-processing-text">Analyse en cours...</h4>
                                            <p class="text-muted">Notre IA extrait les donn√©es de votre document</p>
                                        </div>
                                        <div class="progress-details">
                                            <span id="progress-status">Traitement intelligent</span>
                                            <span id="progress-text">0%</span>
                                        </div>
                                        <div class="progress">
                                            <div class="progress-bar bg-primary" id="progress-bar" role="progressbar"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Results Section -->
                    <div class="row row-cards mt-4 d-none" id="results-section">
                        <div class="col-12">
                            <div class="card">
                                <div class="card-header">
                                    <h3 class="card-title">R√©sultats de l'extraction</h3>
                                    <div class="card-actions">
                                        <span class="badge bg-success" id="confidence-badge">Confiance: 95%</span>
                                        <span class="badge bg-primary" id="type-badge">Type: FACTURE</span>
                                    </div>
                                </div>
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-lg-8">
                                            <!-- Tabs for different views -->
                                            <div class="card-tabs">
                                                <ul class="nav nav-tabs" role="tablist">
                                                    <li class="nav-item" role="presentation">
                                                        <a href="#tabs-extracted" class="nav-link active" data-bs-toggle="tab">Donn√©es extraites</a>
                                                    </li>
                                                    <li class="nav-item" role="presentation">
                                                        <a href="#tabs-validation" class="nav-link" data-bs-toggle="tab">Validation</a>
                                                    </li>
                                                    <li class="nav-item" role="presentation">
                                                        <a href="#tabs-notion" class="nav-link" data-bs-toggle="tab">Mapping Notion</a>
                                                    </li>
                                                </ul>
                                                <div class="tab-content mt-3">
                                                    <div class="tab-pane active show" id="tabs-extracted">
                                                        <div id="extracted-info"></div>
                                                    </div>
                                                    <div class="tab-pane" id="tabs-validation">
                                                        <div id="validation-form-container"></div>
                                                        <div class="mt-3">
                                                            <button class="btn btn-primary" onclick="window.ocrInterface.collectFormData()">
                                                                <svg xmlns="http://www.w3.org/2000/svg" class="icon me-2" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M5 12l5 5l10 -10"/></svg>
                                                                Valider les donn√©es
                                                            </button>
                                                        </div>
                                                    </div>
                                                    <div class="tab-pane" id="tabs-notion">
                                                        <div id="notion-mapping"></div>
                                                        <div class="mt-3 d-flex gap-2">
                                                            <button class="btn btn-primary" id="btn-send-notion" onclick="window.ocrInterface.sendToNotion()">
                                                                <svg xmlns="http://www.w3.org/2000/svg" class="icon me-2" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M22 7.535v9.465a3 3 0 0 1 -2.824 2.995l-.176 .005h-14a3 3 0 0 1 -2.995 -2.824l-.005 -.176v-9.465l9.445 6.297l.116 .066a1 1 0 0 0 .878 0l.116 -.066l9.445 -6.297z"/><path d="M19 4c1.08 0 2.027 .57 2.555 1.427l-9.555 6.37l-9.555 -6.37a2.999 2.999 0 0 1 2.354 -1.42l.201 -.007h14z"/></svg>
                                                                Envoyer vers Notion
                                                            </button>
                                                            <button class="btn" id="btn-preview-data" onclick="window.ocrInterface.previewData()">
                                                                <svg xmlns="http://www.w3.org/2000/svg" class="icon me-2" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="12" cy="12" r="2"/><path d="M22 12c-2.667 4.667 -6 7 -10 7s-7.333 -2.333 -10 -7c2.667 -4.667 6 -7 10 -7s7.333 2.333 10 7"/></svg>
                                                                Pr√©visualiser
                                                            </button>
                                                            <button class="btn" id="btn-export-json" onclick="window.ocrInterface.exportJSON()">
                                                                <svg xmlns="http://www.w3.org/2000/svg" class="icon me-2" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M14 3v4a1 1 0 0 0 1 1h4"/><path d="M11.5 21h-4.5a2 2 0 0 1 -2 -2v-14a2 2 0 0 1 2 -2h7l5 5v5m-5 6h7m-3 -3l3 3l-3 3"/></svg>
                                                                Exporter JSON
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-lg-4">
                                            <h4>Aper√ßu du document</h4>
                                            <div class="border rounded p-3" id="document-preview" style="min-height: 400px;">
                                                <!-- Preview will be inserted here -->
                                            </div>
                                            <div class="mt-3">
                                                <h5>Type d√©tect√©</h5>
                                                <span class="badge bg-primary-lt" id="document-type-badge">FACTURE</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Settings Modal -->
    <div class="modal modal-blur fade" id="settings-modal" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Param√®tres OCR</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <!-- Configuration Status -->
                    <div class="alert" id="config-status">
                        <div class="d-flex">
                            <div>
                                <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="12" cy="12" r="9"/><path d="m9 12l2 2l4 -4"/></svg>
                            </div>
                            <div class="ms-3">
                                <h5 class="alert-title">√âtat de la configuration</h5>
                                <div id="config-details">V√©rification en cours...</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- OpenAI Configuration -->
                    <div class="card mb-3">
                        <div class="card-header">
                            <h4 class="card-title">Configuration OpenAI (OCR Automatique)</h4>
                        </div>
                        <div class="card-body">
                            <div class="mb-3">
                                <label class="form-label d-flex align-items-center">
                                    Cl√© API OpenAI
                                    <span class="badge bg-primary ms-2" id="openai-status">Non configur√©</span>
                                </label>
                                <div class="input-group">
                                    <input type="password" class="form-control" id="api-key-input" placeholder="sk-..." autocomplete="new-password">
                                    <button class="btn btn-outline-secondary" type="button" id="toggle-openai-key">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="12" cy="12" r="2"/><path d="M22 12c-2.667 4.667 -6 7 -10 7s-7.333 -2.333 -10 -7c2.667 -4.667 6 -7 10 -7s7.333 2.333 10 7"/></svg>
                                    </button>
                                    <button class="btn btn-outline-primary" type="button" id="test-openai-key">Tester</button>
                                </div>
                                <small class="form-hint">
                                    Votre cl√© API OpenAI pour l'OCR automatique. 
                                    <a href="https://platform.openai.com/api-keys" target="_blank">Obtenir une cl√©</a>
                                </small>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Mod√®le par d√©faut</label>
                                <select class="form-select" id="default-model">
                                    <option value="gpt-4o-mini">GPT-4o Mini (Rapide, ~0.01$/doc)</option>
                                    <option value="gpt-4o">GPT-4o (Pr√©cision Max, ~0.05$/doc)</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Notion Configuration -->
                    <div class="card mb-3">
                        <div class="card-header">
                            <h4 class="card-title">Configuration Notion (Upload Documents)</h4>
                        </div>
                        <div class="card-body">
                            <div class="mb-3">
                                <label class="form-label d-flex align-items-center">
                                    Cl√© API Notion
                                    <span class="badge bg-success ms-2" id="notion-status">Configur√© (d√©faut)</span>
                                </label>
                                <div class="input-group">
                                    <input type="password" class="form-control" id="notion-api-key-input" placeholder="secret_..." autocomplete="new-password">
                                    <button class="btn btn-outline-secondary" type="button" id="toggle-notion-key">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="12" cy="12" r="2"/><path d="M22 12c-2.667 4.667 -6 7 -10 7s-7.333 -2.333 -10 -7c2.667 -4.667 6 -7 10 -7s7.333 2.333 10 7"/></svg>
                                    </button>
                                    <button class="btn btn-outline-primary" type="button" id="test-notion-key">Tester</button>
                                </div>
                                <small class="form-hint">
                                    Votre cl√© d'int√©gration Notion (optionnel - cl√© par d√©faut fournie).
                                    <a href="https://www.notion.so/my-integrations" target="_blank">Cr√©er une int√©gration</a>
                                </small>
                            </div>
                            
                            <div class="alert alert-info">
                                <h5 class="alert-title">Instructions Notion</h5>
                                <ol class="mb-0 small">
                                    <li>Cr√©ez une <a href="https://www.notion.so/my-integrations" target="_blank">nouvelle int√©gration</a></li>
                                    <li>Copiez la cl√© "Internal Integration Secret"</li>
                                    <li>Partagez vos bases de donn√©es avec l'int√©gration</li>
                                    <li>Red√©marrez le serveur pour appliquer les changements</li>
                                </ol>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Mode Configuration -->
                    <div class="card">
                        <div class="card-header">
                            <h4 class="card-title">Mode de fonctionnement</h4>
                        </div>
                        <div class="card-body">
                            <div class="form-selectgroup form-selectgroup-boxes d-flex flex-column">
                                <label class="form-selectgroup-item flex-fill">
                                    <input type="radio" name="ocr-mode" value="auto" class="form-selectgroup-input" id="mode-auto">
                                    <div class="form-selectgroup-label d-flex align-items-center p-3">
                                        <div class="me-3">
                                            <span class="form-selectgroup-check"></span>
                                        </div>
                                        <div>
                                            <strong>Automatique (Recommand√©)</strong>
                                            <div class="text-muted">OCR automatique avec OpenAI + Upload Notion</div>
                                        </div>
                                    </div>
                                </label>
                                <label class="form-selectgroup-item flex-fill">
                                    <input type="radio" name="ocr-mode" value="manual" class="form-selectgroup-input" id="mode-manual">
                                    <div class="form-selectgroup-label d-flex align-items-center p-3">
                                        <div class="me-3">
                                            <span class="form-selectgroup-check"></span>
                                        </div>
                                        <div>
                                            <strong>Manuel</strong>
                                            <div class="text-muted">Saisie manuelle des donn√©es + Upload Notion</div>
                                        </div>
                                    </div>
                                </label>
                                <label class="form-selectgroup-item flex-fill">
                                    <input type="radio" name="ocr-mode" value="demo" class="form-selectgroup-input" id="mode-demo">
                                    <div class="form-selectgroup-label d-flex align-items-center p-3">
                                        <div class="me-3">
                                            <span class="form-selectgroup-check"></span>
                                        </div>
                                        <div>
                                            <strong>D√©monstration</strong>
                                            <div class="text-muted">Interface compl√®te sans vraies API (test)</div>
                                        </div>
                                    </div>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
                    <button type="button" class="btn btn-primary" onclick="window.ocrInterface.saveSettings()">Sauvegarder</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Libs JS -->
    <script src="https://cdn.jsdelivr.net/npm/@tabler/core@1.0.0-beta20/dist/js/tabler.min.js"></script>
    
    <!-- D√©tection mode fichier local - CRITIQUE POUR L'UPLOAD -->
    <script>
        // D√©tection mode fichier local avec alerte persistante
        if (window.location.protocol === 'file:') {
            document.addEventListener('DOMContentLoaded', function() {
                console.error('üö® ERREUR CRITIQUE : Mode fichier local d√©tect√© !');
                console.error('üìç URL actuelle:', window.location.href);
                console.error('üí° L\'upload de fichiers ne fonctionne PAS en mode fichier local');
                
                // Cr√©er une alerte persistante en haut de page
                const alertDiv = document.createElement('div');
                alertDiv.id = 'file-protocol-alert';
                alertDiv.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    right: 0;
                    background: linear-gradient(135deg, #ff4444, #cc0000);
                    color: white;
                    padding: 20px;
                    text-align: center;
                    z-index: 99999;
                    font-size: 16px;
                    font-weight: bold;
                    box-shadow: 0 4px 20px rgba(0,0,0,0.5);
                    border-bottom: 3px solid #fff;
                    animation: pulse-alert 2s infinite;
                `;
                
                alertDiv.innerHTML = `
                    <div style="max-width: 1200px; margin: 0 auto;">
                        <div style="font-size: 24px; margin-bottom: 10px;">‚ö†Ô∏è ATTENTION : Mode fichier local d√©tect√© !</div>
                        <div style="font-size: 16px; margin-bottom: 15px;">
                            L'upload de fichiers PDF vers Notion ne fonctionnera pas en mode file://
                        </div>
                        <div style="background: rgba(255,255,255,0.2); padding: 15px; border-radius: 8px; margin: 10px 0;">
                            <div style="font-size: 18px; margin-bottom: 10px;">üöÄ SOLUTIONS RAPIDES :</div>
                            <div style="display: flex; justify-content: center; gap: 30px; flex-wrap: wrap;">
                                <div style="text-align: left;">
                                    <div style="font-weight: bold; color: #ffff99;">Windows :</div>
                                    <div>Double-cliquez sur <code style="background: rgba(0,0,0,0.3); padding: 2px 6px; border-radius: 3px;">start-ocr.bat</code></div>
                                </div>
                                <div style="text-align: left;">
                                    <div style="font-weight: bold; color: #ffff99;">Mac/Linux :</div>
                                    <div>Double-cliquez sur <code style="background: rgba(0,0,0,0.3); padding: 2px 6px; border-radius: 3px;">start-ocr.sh</code></div>
                                </div>
                                <div style="text-align: left;">
                                    <div style="font-weight: bold; color: #ffff99;">Manuel :</div>
                                    <div><code style="background: rgba(0,0,0,0.3); padding: 2px 6px; border-radius: 3px;">npm start</code> puis ouvrir<br><code style="background: rgba(0,0,0,0.3); padding: 2px 6px; border-radius: 3px;">http://localhost:3000</code></div>
                                </div>
                            </div>
                        </div>
                        <div style="font-size: 14px; opacity: 0.9;">
                            üìñ Cette page doit √™tre accessible via <strong>http://localhost:3000</strong> pour fonctionner
                        </div>
                    </div>
                `;
                
                // Ajouter l'animation CSS
                const style = document.createElement('style');
                style.textContent = `
                    @keyframes pulse-alert {
                        0%, 100% { transform: scale(1); opacity: 1; }
                        50% { transform: scale(1.02); opacity: 0.95; }
                    }
                `;
                document.head.appendChild(style);
                
                // Ins√©rer l'alerte en premier dans le body
                document.body.insertBefore(alertDiv, document.body.firstChild);
                
                // D√©caler le contenu principal pour √©viter le chevauchement
                const pageWrapper = document.querySelector('.page-wrapper');
                if (pageWrapper) {
                    pageWrapper.style.marginTop = '160px';
                }
                
                // D√©sactiver les fonctionnalit√©s critiques apr√®s chargement
                setTimeout(() => {
                    // D√©sactiver le bouton d'envoi Notion
                    const sendButton = document.querySelector('button[onclick*="sendToNotion"]');
                    if (sendButton) {
                        sendButton.disabled = true;
                        sendButton.innerHTML = '‚ùå Serveur requis - Utilisez start-ocr.bat/sh';
                        sendButton.style.background = '#999';
                        sendButton.style.cursor = 'not-allowed';
                        sendButton.title = 'Lancez le serveur avec start-ocr.bat (Windows) ou start-ocr.sh (Mac/Linux)';
                    }
                    
                    // D√©sactiver la dropzone
                    const dropzone = document.getElementById('dropzone');
                    if (dropzone) {
                        dropzone.style.opacity = '0.5';
                        dropzone.style.cursor = 'not-allowed';
                        dropzone.title = 'Upload impossible en mode fichier local';
                        
                        // Remplacer le contenu de la dropzone
                        const dropzoneContent = dropzone.querySelector('.dropzone-content');
                        if (dropzoneContent) {
                            dropzoneContent.innerHTML = `
                                <svg xmlns="http://www.w3.org/2000/svg" class="icon dropzone-icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 9v4m0 4h.01M21 12a9 9 0 1 1 -18 0a9 9 0 0 1 18 0z"/></svg>
                                <h3 class="mt-4" style="color: #ff4444;">Upload indisponible</h3>
                                <p class="text-muted">Mode fichier local d√©tect√©</p>
                                <p class="text-muted small"><strong>Utilisez start-ocr.bat/sh pour activer l'upload</strong></p>
                            `;
                        }
                    }
                    
                    console.warn('üîí Fonctionnalit√©s d\'upload d√©sactiv√©es en mode fichier local');
                }, 1000);
                
                // Alerte popup apr√®s 3 secondes pour s'assurer que l'utilisateur voit
                setTimeout(() => {
                    alert('‚ö†Ô∏è ERREUR : Mode fichier local d√©tect√© !\n\n' +
                          'L\'upload ne fonctionne pas en mode fichier local.\n\n' +
                          'üöÄ SOLUTIONS RAPIDES :\n' +
                          '‚Ä¢ Windows: Double-cliquez sur start-ocr.bat\n' +
                          '‚Ä¢ Mac/Linux: Double-cliquez sur start-ocr.sh\n' +
                          '‚Ä¢ Manuel: Tapez "npm start" dans un terminal\n\n' +
                          'üìç Puis ouvrez: http://localhost:3000');
                }, 3000);
            });
        } else {
            // Mode serveur HTTP - tout est OK
            console.log('‚úÖ Mode serveur HTTP d√©tect√© - Upload disponible');
            console.log('üìç URL:', window.location.href);
        }
    </script>

    <!-- PDF.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script>
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
    </script>
    
    <!-- Override Notion Integration pour √©viter les erreurs CORS -->
    <script>
        // Override temporaire pour √©viter les erreurs en mode file://
        window.OCRNotionIntegration = class {
            constructor() {
                this.apiKey = localStorage.getItem('notion_api_key') || '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';
            }
            
            async init() {
                console.log('üìÅ Mode fichier local - Notion en mode simulation');
                return true;
            }
            
            async sendDocument(documentType, data, attachmentFile) {
                console.log('üì§ Simulation envoi Notion:', { documentType, data });
                return {
                    success: true,
                    pageId: 'simulation-' + Date.now(),
                    message: 'Document envoy√© (simulation)'
                };
            }
        };
    </script>
    
    <!-- JS OCR -->
    <script src="../../assets/js/Superadmin/ocr-templates-final.js"></script>
    <script src="../../assets/js/Superadmin/ocr-vision-final.js"></script>
    <script src="../../assets/js/Superadmin/ocr-notion-smart-resolver.js"></script>
    <script src="../../assets/js/Superadmin/ocr-interface-final.js"></script>
    
    <!-- Fix drag & drop simple et efficace -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üõ°Ô∏è Configuration drag & drop');
            
            // 1. Bloquer le comportement par d√©faut partout
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                document.body.addEventListener(eventName, function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                }, false);
            });
            
            // 2. Protection sur window aussi
            window.addEventListener('dragover', e => e.preventDefault());
            window.addEventListener('drop', e => e.preventDefault());
            
            // 3. Configurer la dropzone apr√®s un court d√©lai
            setTimeout(function() {
                const dropzone = document.getElementById('dropzone');
                const fileInput = document.getElementById('document-upload');
                
                if (!dropzone || !fileInput) {
                    console.error('‚ùå √âl√©ments manquants');
                    return;
                }
                
                console.log('‚úÖ Configuration dropzone');
                
                // Click
                dropzone.addEventListener('click', () => fileInput.click());
                
                // Drag enter/over
                dropzone.addEventListener('dragenter', e => {
                    e.preventDefault();
                    e.stopPropagation();
                    dropzone.classList.add('drag-over');
                });
                
                dropzone.addEventListener('dragover', e => {
                    e.preventDefault();
                    e.stopPropagation();
                });
                
                // Drag leave
                dropzone.addEventListener('dragleave', e => {
                    e.preventDefault();
                    e.stopPropagation();
                    dropzone.classList.remove('drag-over');
                });
                
                // Drop
                dropzone.addEventListener('drop', e => {
                    e.preventDefault();
                    e.stopPropagation();
                    dropzone.classList.remove('drag-over');
                    
                    const files = e.dataTransfer.files;
                    console.log('üìÑ Fichiers:', files.length);
                    
                    if (files.length > 0 && window.ocrInterface) {
                        window.ocrInterface.handleFileUpload(files[0]);
                    }
                });
                
                // File input change
                fileInput.addEventListener('change', e => {
                    if (e.target.files.length > 0 && window.ocrInterface) {
                        window.ocrInterface.handleFileUpload(e.target.files[0]);
                    }
                });
                
            }, 500);
        });
    </script>
    
    <!-- Configuration API Interface -->
    <script>
        // Configuration Interface pour les cl√©s API
        class APIConfigInterface {
            constructor() {
                this.modal = document.getElementById('settings-modal');
                this.init();
            }
            
            init() {
                // Charger les valeurs existantes
                this.loadCurrentSettings();
                
                // Ajouter les event listeners
                this.addEventListeners();
                
                // V√©rifier le statut initial
                this.checkAPIStatus();
            }
            
            loadCurrentSettings() {
                // Charger les cl√©s depuis localStorage
                const openaiKey = localStorage.getItem('openai_api_key') || '';
                const notionKey = localStorage.getItem('notion_api_key') || '';
                const model = localStorage.getItem('openai_model') || 'gpt-4o-mini';
                
                document.getElementById('api-key-input').value = openaiKey;
                document.getElementById('notion-api-key-input').value = notionKey;
                document.getElementById('default-model').value = model;
                
                // D√©terminer le mode actuel
                if (openaiKey) {
                    document.getElementById('mode-auto').checked = true;
                } else {
                    document.getElementById('mode-manual').checked = true;
                }
            }
            
            addEventListeners() {
                // Toggle password visibility
                document.getElementById('toggle-openai-key').addEventListener('click', () => {
                    this.togglePasswordVisibility('api-key-input');
                });
                
                document.getElementById('toggle-notion-key').addEventListener('click', () => {
                    this.togglePasswordVisibility('notion-api-key-input');
                });
                
                // Test API keys
                document.getElementById('test-openai-key').addEventListener('click', () => {
                    this.testOpenAIKey();
                });
                
                document.getElementById('test-notion-key').addEventListener('click', () => {
                    this.testNotionKey();
                });
                
                // Mode change
                document.querySelectorAll('input[name="ocr-mode"]').forEach(radio => {
                    radio.addEventListener('change', () => {
                        this.handleModeChange(radio.value);
                    });
                });
                
                // Auto-save on changes
                document.getElementById('api-key-input').addEventListener('input', () => {
                    this.updateAPIStatus();
                });
                
                document.getElementById('notion-api-key-input').addEventListener('input', () => {
                    this.updateAPIStatus();
                });
            }
            
            togglePasswordVisibility(inputId) {
                const input = document.getElementById(inputId);
                input.type = input.type === 'password' ? 'text' : 'password';
            }
            
            async testOpenAIKey() {
                const button = document.getElementById('test-openai-key');
                const key = document.getElementById('api-key-input').value;
                
                if (!key) {
                    this.showToast('Veuillez saisir une cl√© API OpenAI', 'warning');
                    return;
                }
                
                button.disabled = true;
                button.textContent = 'Test...';
                
                try {
                    const response = await fetch('https://api.openai.com/v1/models', {
                        headers: { 'Authorization': `Bearer ${key}` }
                    });
                    
                    if (response.ok) {
                        this.showToast('‚úÖ Cl√© OpenAI valide', 'success');
                        document.getElementById('openai-status').textContent = 'Configur√©';
                        document.getElementById('openai-status').className = 'badge bg-success ms-2';
                    } else {
                        this.showToast('‚ùå Cl√© OpenAI invalide', 'error');
                        document.getElementById('openai-status').textContent = 'Invalide';
                        document.getElementById('openai-status').className = 'badge bg-danger ms-2';
                    }
                } catch (error) {
                    this.showToast('‚ùå Erreur de connexion OpenAI', 'error');
                }
                
                button.disabled = false;
                button.textContent = 'Tester';
            }
            
            async testNotionKey() {
                const button = document.getElementById('test-notion-key');
                const key = document.getElementById('notion-api-key-input').value;
                
                if (!key) {
                    this.showToast('Veuillez saisir une cl√© API Notion', 'warning');
                    return;
                }
                
                button.disabled = true;
                button.textContent = 'Test...';
                
                try {
                    const response = await fetch('/api/notion/health');
                    
                    if (response.ok) {
                        this.showToast('‚úÖ Connexion Notion r√©ussie', 'success');
                        document.getElementById('notion-status').textContent = 'Configur√©';
                        document.getElementById('notion-status').className = 'badge bg-success ms-2';
                    } else {
                        this.showToast('‚ùå Erreur connexion Notion', 'error');
                    }
                } catch (error) {
                    this.showToast('‚ùå Erreur de connexion Notion', 'error');
                }
                
                button.disabled = false;
                button.textContent = 'Tester';
            }
            
            handleModeChange(mode) {
                const openaiCard = document.querySelector('.card:has(#api-key-input)');
                
                switch (mode) {
                    case 'auto':
                        openaiCard.style.opacity = '1';
                        this.showToast('Mode automatique s√©lectionn√©', 'info');
                        break;
                    case 'manual':
                        openaiCard.style.opacity = '0.6';
                        this.showToast('Mode manuel s√©lectionn√©', 'info');
                        break;
                    case 'demo':
                        openaiCard.style.opacity = '0.6';
                        this.showToast('Mode d√©monstration s√©lectionn√©', 'info');
                        break;
                }
            }
            
            checkAPIStatus() {
                const openaiKey = localStorage.getItem('openai_api_key');
                const notionKey = localStorage.getItem('notion_api_key');
                
                // Statut OpenAI
                if (openaiKey && openaiKey.startsWith('sk-')) {
                    document.getElementById('openai-status').textContent = 'Configur√©';
                    document.getElementById('openai-status').className = 'badge bg-success ms-2';
                } else {
                    document.getElementById('openai-status').textContent = 'Non configur√©';
                    document.getElementById('openai-status').className = 'badge bg-warning ms-2';
                }
                
                // Statut Notion (toujours configur√© avec la cl√© par d√©faut)
                document.getElementById('notion-status').textContent = 'Configur√© (d√©faut)';
                document.getElementById('notion-status').className = 'badge bg-success ms-2';
                
                this.updateConfigStatus();
            }
            
            updateAPIStatus() {
                setTimeout(() => this.checkAPIStatus(), 100);
            }
            
            updateConfigStatus() {
                const openaiKey = document.getElementById('api-key-input').value;
                const statusDiv = document.getElementById('config-status');
                const detailsDiv = document.getElementById('config-details');
                
                if (openaiKey) {
                    statusDiv.className = 'alert alert-success';
                    detailsDiv.innerHTML = '‚úÖ OCR automatique disponible<br>‚úÖ Upload Notion fonctionnel';
                } else {
                    statusDiv.className = 'alert alert-warning';
                    detailsDiv.innerHTML = '‚ö†Ô∏è Mode manuel uniquement (pas de cl√© OpenAI)<br>‚úÖ Upload Notion fonctionnel';
                }
            }
            
            saveSettings() {
                const openaiKey = document.getElementById('api-key-input').value;
                const notionKey = document.getElementById('notion-api-key-input').value;
                const model = document.getElementById('default-model').value;
                
                // Sauvegarder dans localStorage
                if (openaiKey) {
                    localStorage.setItem('openai_api_key', openaiKey);
                }
                if (notionKey) {
                    localStorage.setItem('notion_api_key', notionKey);
                }
                localStorage.setItem('openai_model', model);
                
                this.showToast('‚úÖ Configuration sauvegard√©e', 'success');
                
                // Fermer le modal
                const modal = bootstrap.Modal.getInstance(this.modal);
                if (modal) {
                    modal.hide();
                }
                
                // Recharger l'interface OCR
                setTimeout(() => {
                    if (window.ocrInterface) {
                        window.ocrInterface.init();
                    }
                }, 500);
            }
            
            showToast(message, type) {
                // Simple toast notification
                const toast = document.createElement('div');
                toast.className = `alert alert-${type === 'error' ? 'danger' : type} position-fixed`;
                toast.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 300px;';
                toast.innerHTML = `
                    <div class="d-flex">
                        <div class="flex-fill">${message}</div>
                        <button type="button" class="btn-close" onclick="this.parentElement.parentElement.remove()"></button>
                    </div>
                `;
                
                document.body.appendChild(toast);
                
                setTimeout(() => {
                    if (toast.parentElement) {
                        toast.remove();
                    }
                }, 3000);
            }
        }
        
        // Gestion du s√©lecteur de p√©riode
        document.querySelectorAll('[data-period]').forEach(item => {
            item.addEventListener('click', (e) => {
                e.preventDefault();
                const period = e.target.dataset.period;
                
                // Mettre √† jour le bouton
                document.getElementById('current-period').textContent = e.target.textContent;
                
                // Mettre √† jour l'√©tat actif
                document.querySelectorAll('[data-period]').forEach(i => i.classList.remove('active'));
                e.target.classList.add('active');
                
                // Mettre √† jour les stats
                updateStats(period);
            });
        });
        
        function updateStats(period) {
            const counts = {
                today: 12,
                week: 84,
                month: 356,
                year: 4521
            };
            
            document.getElementById('docs-count').textContent = counts[period] || 0;
            
            // Animation du changement
            document.querySelectorAll('.stat-card').forEach((card, index) => {
                card.style.opacity = '0';
                card.style.transform = 'translateY(10px)';
                
                setTimeout(() => {
                    card.style.opacity = '1';
                    card.style.transform = 'translateY(0)';
                    card.style.transition = 'all 0.3s ease';
                }, index * 50);
            });
        }
        
        // Initialiser l'interface de configuration
        let apiConfigInterface;
        document.addEventListener('DOMContentLoaded', function() {
            apiConfigInterface = new APIConfigInterface();
            
            // Rendre accessible globalement pour le bouton de sauvegarde
            if (!window.ocrInterface) {
                window.ocrInterface = {};
            }
            window.ocrInterface.saveSettings = () => apiConfigInterface.saveSettings();
        });
    </script>
</body>
</html>