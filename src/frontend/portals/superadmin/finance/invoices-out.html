<!doctype html>
<html lang="fr">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
    <meta http-equiv="X-UA-Compatible" content="ie=edge"/>
    <title>Factures Clients - Finance Superadmin</title>
    
    <!-- CSS Tabler -->
    <link href="https://cdn.jsdelivr.net/npm/@tabler/core@latest/dist/css/tabler.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/@tabler/core@latest/dist/css/tabler-flags.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/@tabler/core@latest/dist/css/tabler-payments.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/@tabler/core@latest/dist/css/tabler-vendors.min.css" rel="stylesheet">
    
    <!-- Tabler Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@tabler/icons@latest/iconfont/tabler-icons.min.css">    <link href="../../assets/css/custom.css" rel="stylesheet"/>
    <link href="../../assets/css/superadmin-custom.css" rel="stylesheet"/>
    
    <!-- DataTables CSS -->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.7/css/dataTables.bootstrap5.min.css">
    
    <style>
        /* Dark mode toggle visibility */
        [data-bs-theme="dark"] .hide-theme-dark { display: none !important; }
        [data-bs-theme="light"] .hide-theme-light { display: none !important; }
        
        /* JetBrains Mono pour les valeurs numériques */
        .metric-value,
        .h1,
        .amount,
        .total-amount,
        .percentage-value,
        .stats-number,
        .revenue-value {
            font-family: 'JetBrains Mono', monospace !important;
            font-weight: 600;
        }
        
        /* Styles spécifiques factures clients */
        .invoice-status {
            font-size: 0.75rem;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .status-draft {
            background: #f8f9fa;
            color: #6c757d;
            border: 1px solid #dee2e6;
        }
        
        .status-sent {
            background: #e3f2fd;
            color: #1565c0;
            border: 1px solid #bbdefb;
        }
        
        .status-viewed {
            background: #fff3e0;
            color: #e65100;
            border: 1px solid #ffcc02;
        }
        
        .status-paid {
            background: #e8f5e8;
            color: #2e7d32;
            border: 1px solid #a5d6a7;
        }
        
        .status-overdue {
            background: #ffebee;
            color: #c62828;
            border: 1px solid #ef9a9a;
        }
        
        .invoice-actions {
            display: flex;
            gap: 0.25rem;
            justify-content: center;
        }
        
        .action-btn {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .action-btn:hover {
            transform: scale(1.1);
        }
        
        .action-view { background: #e3f2fd; color: #1976d2; }
        .action-edit { background: #fff3e0; color: #f57c00; }
        .action-send { background: #e8f5e8; color: #388e3c; }
        .action-duplicate { background: #f3e5f5; color: #7b1fa2; }
        
        .amount {
            font-weight: 600;
            font-family: 'JetBrains Mono', monospace;
        }
        
        .totals-summary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        
        .total-item {
            text-align: center;
        }
        
        .total-label {
            font-size: 0.875rem;
            opacity: 0.9;
            margin-bottom: 0.5rem;
        }
        
        .total-value {
            font-size: 1.5rem;
            font-weight: 700;
            font-family: 'SF Mono', Consolas, monospace;
        }
        
        .invoice-preview {
            border: 1px solid #dee2e6;
            border-radius: 8px;
            overflow: hidden;
            background: white;
        }
        
        .entity-badge {
            display: inline-flex;
            align-items: center;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            color: white;
        }
        
        .entity-hypervisual { background: #e41e26; }
        .entity-dainamics { background: #0066cc; }
        .entity-waveform { background: #f76707; }
        .entity-particule { background: #ae3ec9; }
        .entity-holding { background: #d63939; }
        
        .client-info {
            display: flex;
            flex-direction: column;
        }
        
        .client-name {
            font-weight: 600;
            color: #1976d2;
        }
        
        .client-contact {
            font-size: 0.875rem;
            color: #666;
        }
        
        .filter-row {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1.5rem;
        }
        
        .quick-stats {
            display: flex;
            gap: 2rem;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .stat-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .stat-icon {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .reminder-indicator {
            position: relative;
        }
        
        .reminder-count {
            position: absolute;
            top: -4px;
            right: -4px;
            background: #dc3545;
            color: white;
            font-size: 0.625rem;
            padding: 0.125rem 0.375rem;
            border-radius: 10px;
            min-width: 16px;
            text-align: center;
        }
        
        @media (max-width: 768px) {
            .totals-summary .row > div {
                margin-bottom: 1rem;
            }
            
            .quick-stats {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
            }
        }
        
    </style>
</head>
<body data-bs-theme="light">
    <div class="page">
        <!-- Sidebar (same as dashboard) -->
        <aside class="navbar navbar-vertical navbar-expand-lg navbar-superadmin" data-bs-theme="dark">
            <div class="container-fluid">
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#sidebar-menu">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <h1 class="navbar-brand navbar-brand-autodark">
                    <a href="../dashboard.html">
                        <img src="../../assets/img/logo.svg" width="110" height="32" alt="Dashboard" class="navbar-brand-image">
                    </a>
                </h1>
                <div class="collapse navbar-collapse" id="sidebar-menu">
                    <ul class="navbar-nav pt-lg-3">
                        <li class="nav-item">
                            <a class="nav-link" href="../dashboard.html">
                                <span class="nav-link-icon d-md-none d-lg-inline-block">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M5 12l-2 0l9 -9l9 9l-2 0" /><path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" /><path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" /></svg>
                                </span>
                                <span class="nav-link-title">Dashboard</span>
                            </a>
                        </li>
                        
                        <!-- SECTION FINANCE -->
                        <li class="nav-item dropdown active">
                            <a class="nav-link dropdown-toggle show" href="#navbar-finance" data-bs-toggle="dropdown" data-bs-auto-close="false" role="button" aria-expanded="true">
                                <span class="nav-link-icon d-md-none d-lg-inline-block">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M16.7 8a3 3 0 0 0 -2.7 -2h-4a3 3 0 0 0 0 6h4a3 3 0 0 1 0 6h-4a3 3 0 0 1 -2.7 -2" /><path d="M12 3v3m0 12v3" /></svg>
                                </span>
                                <span class="nav-link-title">Finance & Comptabilité</span>
                            </a>
                            <div class="dropdown-menu show">
                                <div class="dropdown-menu-columns">
                                    <div class="dropdown-menu-column">
                                        <a class="dropdown-item" href="./ocr-upload.html">Centre OCR</a>
                                        <a class="dropdown-item" href="./invoices-in.html">Factures Fournisseurs</a>
                                        <a class="dropdown-item active" href="./invoices-out.html">Factures Clients</a>
                                        <a class="dropdown-item" href="./expenses.html">Notes de Frais</a>
                                        <a class="dropdown-item" href="./banking.html">Banking Revolut</a>
                                        <a class="dropdown-item" href="./accounting.html">Comptabilité</a>
                                        <a class="dropdown-item" href="./vat-reports.html">Déclarations TVA</a>
                                        <a class="dropdown-item" href="./monthly-reports.html">Bilans Mensuels</a>
                                    </div>
                                </div>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>
        </aside>
        
        <!-- Header -->
        <header class="navbar navbar-expand-md d-none d-lg-flex d-print-none">
            <div class="container-xl">
                <div class="navbar-nav flex-row order-md-last">
                    <!-- Dark Mode Toggle -->
                    <div class="nav-item d-none d-md-flex me-3">
                        <div class="btn-list-item">
                            <a href="#" class="nav-link px-0 hide-theme-dark" title="Enable dark mode" data-bs-toggle="tooltip" data-bs-placement="bottom" onclick="document.body.setAttribute('data-bs-theme', 'dark')">
                                <i class="ti ti-moon"></i>
                            </a>
                            <a href="#" class="nav-link px-0 hide-theme-light" title="Enable light mode" data-bs-toggle="tooltip" data-bs-placement="bottom" onclick="document.body.setAttribute('data-bs-theme', 'light')">
                                <i class="ti ti-sun"></i>
                            </a>
                        </div>
                    </div>
                    
                    <div class="nav-item dropdown">
                        <a href="#" class="nav-link d-flex lh-1 text-reset p-0" data-bs-toggle="dropdown">
                            <span class="avatar avatar-sm" style="background-image: url(https://eu.ui-avatars.com/api/?name=Paul+Martin&background=c44569&color=fff)"></span>
                            <div class="d-none d-xl-block ps-2">
                                <div>Paul Martin</div>
                                <div class="mt-1 small text-secondary">
                                    <span class="badge bg-red">SUPERADMIN</span>
                                </div>
                            </div>
                        </a>
                        <div class="dropdown-menu dropdown-menu-end dropdown-menu-arrow">
                            <a href="#" class="dropdown-item">Mon Profil</a>
                            <a href="#" class="dropdown-item">Paramètres 2FA</a>
                            <div class="dropdown-divider"></div>
                            <a href="../../logout.html" class="dropdown-item">Déconnexion</a>
                        </div>
                    </div>
                </div>
            </div>
        </header>
        
        <!-- Page content -->
        <div class="page-wrapper">
            <div class="page-header d-print-none">
                <div class="container-xl">
                    <div class="row g-2 align-items-center">
                        <div class="col">
                            <div class="page-pretitle">Finance</div>
                            <h2 class="page-title">
                                Factures Clients & Suivi
                            </h2>
                        </div>
                        <div class="col-auto ms-auto d-print-none">
                            <div class="btn-list">
                                <button class="btn btn-outline-primary" id="from-project">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none">
                                        <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                        <path d="M9 5h-2a2 2 0 0 0 -2 2v12a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-12a2 2 0 0 0 -2 -2h-2" />
                                        <path d="M9 3m0 2a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v0a2 2 0 0 1 -2 2h-2a2 2 0 0 1 -2 -2z" />
                                        <path d="M12 16l0 -8l-3 3" />
                                        <path d="M9 11l6 0" />
                                    </svg>
                                    Depuis Projet
                                </button>
                                <button class="btn btn-outline-primary" id="export-invoices">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none">
                                        <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                        <path d="M14 3v4a1 1 0 0 0 1 1h4" />
                                        <path d="M17 21h-10a2 2 0 0 1 -2 -2v-14a2 2 0 0 1 2 -2h7l5 5v11a2 2 0 0 1 -2 2z" />
                                        <path d="M9 12l1 1l2 -2l2 2l1 -1" />
                                    </svg>
                                    Export
                                </button>
                                <button class="btn btn-warning" id="send-reminders">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none">
                                        <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                        <path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5" />
                                        <path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5" />
                                    </svg>
                                    Relances
                                    <span class="badge bg-warning ms-1" id="reminders-count">0</span>
                                </button>
                                <button class="btn btn-primary" id="new-invoice">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none">
                                        <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                        <path d="M12 5l0 14" />
                                        <path d="M5 12l14 0" />
                                    </svg>
                                    Nouvelle Facture
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="page-body">
                <div class="container-xl">
                    <!-- Loading Indicator -->
                    <div id="loading-indicator" class="text-center py-4" style="display: none;">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">Chargement...</span>
                        </div>
                    </div>
                    
                    <!-- Totaux -->
                    <div class="totals-summary">
                        <div class="row">
                            <div class="col-md-3">
                                <div class="total-item">
                                    <div class="total-label">Total Émis</div>
                                    <div class="total-value metric-value" id="total-issued">CHF 0</div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="total-item">
                                    <div class="total-label">Payé</div>
                                    <div class="total-value metric-value" id="total-paid">CHF 0</div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="total-item">
                                    <div class="total-label">En Attente</div>
                                    <div class="total-value metric-value" id="total-pending">CHF 0</div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="total-item">
                                    <div class="total-label">En Retard</div>
                                    <div class="total-value metric-value" id="total-overdue">CHF 0</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Filtres et Stats -->
                    <div class="filter-row">
                        <div class="row align-items-center">
                            <div class="col-md-8">
                                <div class="row g-2">
                                    <div class="col-md-3">
                                        <select class="form-select" id="filter-status">
                                            <option value="">Tous les statuts</option>
                                            <option value="draft">Brouillons</option>
                                            <option value="sent">Envoyées</option>
                                            <option value="viewed">Vues</option>
                                            <option value="paid">Payées</option>
                                            <option value="overdue">En retard</option>
                                        </select>
                                    </div>
                                    <div class="col-md-3">
                                        <select class="form-select" id="filter-entity">
                                            <option value="">Toutes les entités</option>
                                            <option value="hypervisual">Hypervisual</option>
                                            <option value="dainamics">Dainamics</option>
                                            <option value="waveform">Waveform</option>
                                            <option value="particule">Particule</option>
                                            <option value="holding">Swiss Digital Holding</option>
                                        </select>
                                    </div>
                                    <div class="col-md-3">
                                        <select class="form-select" id="filter-client">
                                            <option value="">Tous les clients</option>
                                        </select>
                                    </div>
                                    <div class="col-md-3">
                                        <button class="btn btn-outline-secondary w-100" id="clear-filters">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none">
                                                <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                                <path d="M19 19h-11l-4 -4a1 1 0 0 1 0 -1.41l10 -10a1 1 0 0 1 1.41 0l5 5a1 1 0 0 1 0 1.41l-9 9" />
                                                <path d="M18 12.3l-6.3 -6.3" />
                                            </svg>
                                            Effacer
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="quick-stats">
                                    <div class="stat-item">
                                        <div class="stat-icon bg-primary text-white">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="16" height="16" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none">
                                                <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                                <path d="M14 3v4a1 1 0 0 0 1 1h4" />
                                                <path d="M17 21h-10a2 2 0 0 1 -2 -2v-14a2 2 0 0 1 2 -2h7l5 5v11a2 2 0 0 1 -2 2z" />
                                            </svg>
                                        </div>
                                        <div>
                                            <div class="fw-bold" id="invoices-count">0</div>
                                            <div class="text-muted small">Factures</div>
                                        </div>
                                    </div>
                                    <div class="stat-item">
                                        <div class="stat-icon bg-success text-white">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="16" height="16" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none">
                                                <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                                <path d="M5 12l5 5l10 -10" />
                                            </svg>
                                        </div>
                                        <div>
                                            <div class="fw-bold" id="paid-count">0</div>
                                            <div class="text-muted small">Payées</div>
                                        </div>
                                    </div>
                                    <div class="stat-item">
                                        <div class="stat-icon bg-warning text-white reminder-indicator">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="16" height="16" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none">
                                                <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                                <path d="M10 5a2 2 0 1 1 4 0a7 7 0 0 1 4 6v3a4 4 0 0 0 2 3h-16a4 4 0 0 0 2 -3v-3a7 7 0 0 1 4 -6" />
                                                <path d="M9 17v1a3 3 0 0 0 6 0v-1" />
                                            </svg>
                                            <span class="reminder-count" id="urgent-reminders">0</span>
                                        </div>
                                        <div>
                                            <div class="fw-bold" id="overdue-count">0</div>
                                            <div class="text-muted small">En retard</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Actions Groupées -->
                    <div class="card mb-3" id="bulk-actions" style="display: none;">
                        <div class="card-body py-2">
                            <div class="row align-items-center">
                                <div class="col">
                                    <span class="text-muted">
                                        <span id="selected-count">0</span> facture(s) sélectionnée(s)
                                    </span>
                                </div>
                                <div class="col-auto">
                                    <div class="btn-list">
                                        <button class="btn btn-sm btn-primary" id="bulk-send">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="16" height="16" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none">
                                                <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                                <path d="M10 14l11 -11" />
                                                <path d="M21 3l-6.5 18a.55 .55 0 0 1 -1 0l-3.5 -7l-7 -3.5a.55 .55 0 0 1 0 -1l18 -6.5" />
                                            </svg>
                                            Envoyer
                                        </button>
                                        <button class="btn btn-sm btn-outline-primary" id="bulk-duplicate">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="16" height="16" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none">
                                                <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                                <path d="M7 7m0 2.667a2.667 2.667 0 0 1 2.667 -2.667h8.666a2.667 2.667 0 0 1 2.667 2.667v8.666a2.667 2.667 0 0 1 -2.667 2.667h-8.666a2.667 2.667 0 0 1 -2.667 -2.667z" />
                                                <path d="M4.012 16.737a2.005 2.005 0 0 1 -1.012 -1.737v-10c0 -1.1 .9 -2 2 -2h10c.75 0 1.158 .385 1.5 1" />
                                            </svg>
                                            Dupliquer
                                        </button>
                                        <button class="btn btn-sm btn-outline-secondary" id="bulk-export">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="16" height="16" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none">
                                                <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                                <path d="M14 3v4a1 1 0 0 0 1 1h4" />
                                                <path d="M17 21h-10a2 2 0 0 1 -2 -2v-14a2 2 0 0 1 2 -2h7l5 5v11a2 2 0 0 1 -2 2z" />
                                                <path d="M12 13l0 3l-2 -2m4 0l-2 2" />
                                            </svg>
                                            Exporter
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Table -->
                    <div class="card">
                        <div class="table-responsive">
                            <table class="table card-table table-vcenter text-nowrap datatable" id="invoices-table">
                                <thead>
                                    <tr>
                                        <th class="w-1">
                                            <input class="form-check-input" type="checkbox" id="select-all">
                                        </th>
                                        <th>N° Facture</th>
                                        <th>Client</th>
                                        <th>Entité</th>
                                        <th class="text-end">Montant</th>
                                        <th>Date Émission</th>
                                        <th>Échéance</th>
                                        <th>Statut</th>
                                        <th>Suivi</th>
                                        <th class="text-center">Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Sera rempli par JS -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal Nouvelle Facture -->
    <div class="modal modal-lg fade" id="newInvoiceModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Nouvelle Facture Client</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="newInvoiceForm">
                        <div class="row">
                            <!-- Informations de base -->
                            <div class="col-md-6">
                                <h4 class="mb-3">Informations générales</h4>
                                <div class="mb-3">
                                    <label class="form-label required">Entité émettrice</label>
                                    <select class="form-select" id="invoice-entity" required>
                                        <option value="">Sélectionner une entité</option>
                                        <option value="hypervisual">Hypervisual Sàrl</option>
                                        <option value="dainamics">Dainamics SA</option>
                                        <option value="waveform">Waveform Studio</option>
                                        <option value="particule">Particule Agency</option>
                                        <option value="holding">Swiss Digital Holding</option>
                                    </select>
                                </div>
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label class="form-label">Date facture</label>
                                            <input type="date" class="form-control" id="invoice-date" required>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label class="form-label">Date échéance</label>
                                            <input type="date" class="form-control" id="due-date" required>
                                        </div>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Conditions de paiement</label>
                                    <select class="form-select" id="payment-terms">
                                        <option value="30 jours net">30 jours net</option>
                                        <option value="15 jours net">15 jours net</option>
                                        <option value="À réception">À réception</option>
                                        <option value="60 jours net">60 jours net</option>
                                    </select>
                                </div>
                            </div>
                            
                            <!-- Informations client -->
                            <div class="col-md-6">
                                <h4 class="mb-3">Client</h4>
                                <div class="mb-3">
                                    <label class="form-label required">Nom de l'entreprise</label>
                                    <div class="input-group">
                                        <input type="text" class="form-control" id="client-company" required>
                                        <button class="btn btn-outline-primary" type="button" id="search-client">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="16" height="16" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none">
                                                <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                                <path d="M10 10m-7 0a7 7 0 1 0 14 0a7 7 0 1 0 -14 0" />
                                                <path d="M21 21l-6 -6" />
                                            </svg>
                                        </button>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Personne de contact</label>
                                    <input type="text" class="form-control" id="client-contact">
                                </div>
                                <div class="mb-3">
                                    <label class="form-label required">Email</label>
                                    <input type="email" class="form-control" id="client-email" required>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">N° TVA</label>
                                    <input type="text" class="form-control" id="client-vat" placeholder="CHE-123.456.789 TVA">
                                </div>
                                <div class="mb-3">
                                    <label class="form-label required">Adresse complète</label>
                                    <textarea class="form-control" id="client-address" rows="3" required></textarea>
                                </div>
                            </div>
                        </div>
                        
                        <hr>
                        
                        <!-- Lignes de facture -->
                        <h4 class="mb-3">Lignes de facture</h4>
                        <div class="table-responsive">
                            <table class="table" id="invoice-items">
                                <thead>
                                    <tr>
                                        <th style="width: 40%">Description</th>
                                        <th style="width: 10%">Qté</th>
                                        <th style="width: 15%">Prix unitaire</th>
                                        <th style="width: 10%">TVA %</th>
                                        <th style="width: 15%">Total HT</th>
                                        <th style="width: 10%"></th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr class="invoice-item">
                                        <td><input type="text" class="form-control item-description" placeholder="Description du service/produit"></td>
                                        <td><input type="number" class="form-control item-quantity" value="1" min="0" step="0.01"></td>
                                        <td><input type="number" class="form-control item-price" min="0" step="0.01" placeholder="0.00"></td>
                                        <td>
                                            <select class="form-select item-vat">
                                                <option value="7.7">7.7%</option>
                                                <option value="2.5">2.5%</option>
                                                <option value="0">0%</option>
                                            </select>
                                        </td>
                                        <td><input type="number" class="form-control item-total" readonly placeholder="0.00"></td>
                                        <td>
                                            <button type="button" class="btn btn-sm btn-outline-danger remove-item">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="16" height="16" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none">
                                                    <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                                    <path d="M18 6l-12 0" />
                                                    <path d="M6 6l0 14a2 2 0 0 0 2 2h8a2 2 0 0 0 2 -2l0 -14" />
                                                    <path d="M9 5l0 -1a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2l0 1" />
                                                </svg>
                                            </button>
                                        </td>
                                    </tr>
                                </tbody>
                                <tfoot>
                                    <tr>
                                        <td colspan="6">
                                            <button type="button" class="btn btn-sm btn-outline-primary" id="add-item">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="16" height="16" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none">
                                                    <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                                    <path d="M12 5l0 14" />
                                                    <path d="M5 12l14 0" />
                                                </svg>
                                                Ajouter une ligne
                                            </button>
                                        </td>
                                    </tr>
                                </tfoot>
                            </table>
                        </div>
                        
                        <!-- Totaux -->
                        <div class="row justify-content-end">
                            <div class="col-md-4">
                                <table class="table table-sm">
                                    <tr>
                                        <td>Total HT:</td>
                                        <td class="text-end"><span id="subtotal-display">0.00</span> CHF</td>
                                    </tr>
                                    <tr>
                                        <td>TVA:</td>
                                        <td class="text-end"><span id="vat-display">0.00</span> CHF</td>
                                    </tr>
                                    <tr class="fw-bold">
                                        <td>Total TTC:</td>
                                        <td class="text-end"><span id="total-display">0.00</span> CHF</td>
                                    </tr>
                                </table>
                            </div>
                        </div>
                        
                        <!-- Notes -->
                        <div class="mb-3">
                            <label class="form-label">Notes et remarques</label>
                            <textarea class="form-control" id="invoice-notes" rows="3" placeholder="Informations supplémentaires..."></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
                    <button type="button" class="btn btn-outline-primary" id="save-draft">Sauver en brouillon</button>
                    <button type="button" class="btn btn-primary" id="preview-invoice">Aperçu & Créer</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal Aperçu Facture -->
    <div class="modal modal-lg fade" id="previewInvoiceModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Aperçu Facture</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" id="invoice-preview-content">
                    <!-- Sera rempli par JS -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fermer</button>
                    <button type="button" class="btn btn-outline-primary" id="download-pdf">
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="16" height="16" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none">
                            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                            <path d="M14 3v4a1 1 0 0 0 1 1h4" />
                            <path d="M17 21h-10a2 2 0 0 1 -2 -2v-14a2 2 0 0 1 2 -2h7l5 5v11a2 2 0 0 1 -2 2z" />
                            <path d="M12 17l0 -6l-3 3" />
                            <path d="M9 14l6 0" />
                        </svg>
                        Télécharger PDF
                    </button>
                    <button type="button" class="btn btn-success" id="send-invoice">
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="16" height="16" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none">
                            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                            <path d="M10 14l11 -11" />
                            <path d="M21 3l-6.5 18a.55 .55 0 0 1 -1 0l-3.5 -7l-7 -3.5a.55 .55 0 0 1 0 -1l18 -6.5" />
                        </svg>
                        Envoyer par Email
                    </button>
                    <button type="button" class="btn btn-primary" id="create-invoice">Créer la Facture</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal Détails Facture -->
    <div class="modal modal-lg fade" id="invoiceDetailsModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Détails Facture</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" id="invoice-details-content">
                    <!-- Sera rempli par JS -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fermer</button>
                    <button type="button" class="btn btn-outline-primary" id="edit-invoice" style="display: none;">
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="16" height="16" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none">
                            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                            <path d="M7 7h-1a2 2 0 0 0 -2 2v9a2 2 0 0 0 2 2h9a2 2 0 0 0 2 -2v-1" />
                            <path d="M20.385 6.585a2.1 2.1 0 0 0 -2.97 -2.97l-8.415 8.385v3h3l8.385 -8.415z" />
                            <path d="M16 5l3 3" />
                        </svg>
                        Modifier
                    </button>
                    <button type="button" class="btn btn-primary" id="send-invoice-now" style="display: none;">
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="16" height="16" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none">
                            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                            <path d="M10 14l11 -11" />
                            <path d="M21 3l-6.5 18a.55 .55 0 0 1 -1 0l-3.5 -7l-7 -3.5a.55 .55 0 0 1 0 -1l18 -6.5" />
                        </svg>
                        Envoyer
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- JS Libs -->
    <!-- JS Tabler -->
    <script src="https://cdn.jsdelivr.net/npm/@tabler/core@latest/dist/js/tabler.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.7/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.7/js/dataTables.bootstrap5.min.js"></script>
    
    <!-- App Core -->
    <script src="../../assets/js/app.js"></script>
    <script src="../../assets/js/auth-notion.js"></script>
    <script src="../../assets/js/permissions-notion.js"></script>
    
    <!-- Modules Superadmin -->
    <script src="../../assets/js/auth-superadmin.js"></script>
    <script src="../../assets/js/permissions-superadmin.js"></script>
    <script src="../../assets/js/invoices-out-notion.js"></script>
    
    <script>
        document.addEventListener('DOMContentLoaded', async function() {
            // Vérifier authentification et 2FA
            if (!window.AuthSuperadmin.isAuthenticated()) {
                window.location.href = '/portal-project/login.html';
                return;
            }
            
            if (!window.AuthSuperadmin.isTwoFactorVerified()) {
                window.location.href = '/portal-project/superadmin/2fa-verify.html';
                return;
            }
            
            // Vérifier permissions
            if (!await window.PermissionsSuperadmin.hasPermission('superadmin.finance.view')) {
                alert('Accès refusé : permissions insuffisantes');
                window.location.href = '/portal-project/login.html';
                return;
            }
            
            // Logger accès
            await window.AuthSuperadmin.logAuditEvent('INVOICES_OUT_ACCESS', {
                page: 'invoices_out'
            });
            
            console.log('Module Factures Clients chargé avec succès');
            
            // Initialiser le module
            await window.InvoicesOutNotion.init();
        });
    </script>
</body>
</html>