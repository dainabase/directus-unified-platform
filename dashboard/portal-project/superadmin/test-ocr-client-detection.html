<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test OCR - D√©tection Client</title>
    <link href="https://cdn.jsdelivr.net/npm/@tabler/core@1.0.0-beta20/dist/css/tabler.min.css" rel="stylesheet"/>
    <style>
        .test-document {
            font-family: monospace;
            white-space: pre-wrap;
            background: #f4f4f4;
            padding: 1rem;
            border-radius: 4px;
            margin: 1rem 0;
        }
        .result-box {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 1rem;
            border-radius: 4px;
            margin: 1rem 0;
        }
        .success { color: #198754; }
        .error { color: #dc3545; }
    </style>
</head>
<body>
    <div class="page">
        <div class="container-fluid py-4">
            <h1 class="page-title mb-4">üß™ Test OCR - D√©tection Client</h1>
            
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">Test des documents AN-00087 et AN-00094</h3>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <h4>Document AN-00087</h4>
                            <div class="test-document" id="doc1">HYPERVISUAL by HMF Corporation SA
Avenue de Beauregard 1
1700 Fribourg

PUBLIGRAMA ADVERTISING S.L.
STREET O, NAVE 1 Riba-Roja del Turia
46190 Valencia
Spain

Offer AN-00087
Date: 25.07.2025

Digital Marketing Campaign     EUR 5,000.00
Social Media Management       EUR 2,500.00

Total                         EUR 7,500.00</div>
                            <button class="btn btn-primary" onclick="testDocument('doc1', 'PUBLIGRAMA ADVERTISING S.L.')">
                                Tester AN-00087
                            </button>
                            <div class="result-box" id="result1" style="display:none;"></div>
                        </div>
                        
                        <div class="col-md-6">
                            <h4>Document AN-00094</h4>
                            <div class="test-document" id="doc2">HYPERVISUAL by HMF Corporation SA
Avenue de Beauregard 1
1700 Fribourg

PROMIDEA SRL
Via Roma 123
20121 Milano
Italy

Invoice AN-00094
Date: 10.08.2025

Branding Consultation         EUR 3,000.00
Logo Design                   EUR 1,500.00

Total excluding VAT           EUR 4,500.00</div>
                            <button class="btn btn-primary" onclick="testDocument('doc2', 'PROMIDEA SRL')">
                                Tester AN-00094
                            </button>
                            <div class="result-box" id="result2" style="display:none;"></div>
                        </div>
                    </div>
                    
                    <div class="mt-4">
                        <h4>Test complet avec processeur OCR</h4>
                        <button class="btn btn-success" onclick="runFullTest()">
                            Lancer test complet
                        </button>
                        <div class="result-box" id="fullResult" style="display:none;"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/tesseract.js@4/dist/tesseract.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/pdfjs-dist@3/build/pdf.min.js"></script>
    <script>
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdn.jsdelivr.net/npm/pdfjs-dist@3/build/pdf.worker.min.js';
    </script>
    <script src="../assets/js/Superadmin/ocr-hybrid-processor.js"></script>
    
    <script>
        async function testDocument(docId, expectedClient) {
            const docText = document.getElementById(docId).textContent;
            const resultId = docId === 'doc1' ? 'result1' : 'result2';
            const resultDiv = document.getElementById(resultId);
            
            try {
                const processor = new OCRHybridProcessor();
                await processor.init();
                
                // Test extraction client
                const clientInfo = processor.extractClientInfo(docText);
                
                // Test extraction compl√®te
                const fullData = await processor.extractBasicData(docText);
                
                const success = clientInfo.client === expectedClient;
                
                resultDiv.innerHTML = `
                    <h5 class="${success ? 'success' : 'error'}">
                        ${success ? '‚úÖ Succ√®s' : '‚ùå √âchec'}
                    </h5>
                    <p><strong>Client d√©tect√©:</strong> "${clientInfo.client}"</p>
                    <p><strong>Client attendu:</strong> "${expectedClient}"</p>
                    <p><strong>Adresse:</strong> ${clientInfo.clientAddress}</p>
                    <p><strong>Pays:</strong> ${clientInfo.clientCountry}</p>
                    <hr>
                    <p><strong>Devise:</strong> ${fullData.devise}</p>
                    <p><strong>Statut TVA:</strong> ${fullData.vat_status}</p>
                `;
                
                resultDiv.style.display = 'block';
                
            } catch (error) {
                resultDiv.innerHTML = `<p class="error">Erreur: ${error.message}</p>`;
                resultDiv.style.display = 'block';
            }
        }
        
        async function runFullTest() {
            const resultDiv = document.getElementById('fullResult');
            resultDiv.innerHTML = '<p>Test en cours...</p>';
            resultDiv.style.display = 'block';
            
            try {
                const processor = new OCRHybridProcessor();
                await processor.init();
                
                // Test sur les deux documents
                const docs = [
                    { id: 'doc1', expected: 'PUBLIGRAMA ADVERTISING S.L.', name: 'AN-00087' },
                    { id: 'doc2', expected: 'PROMIDEA SRL', name: 'AN-00094' }
                ];
                
                let results = [];
                
                for (const doc of docs) {
                    const docText = document.getElementById(doc.id).textContent;
                    const clientInfo = processor.extractClientInfo(docText);
                    const success = clientInfo.client === doc.expected;
                    
                    results.push({
                        name: doc.name,
                        success: success,
                        detected: clientInfo.client,
                        expected: doc.expected
                    });
                }
                
                const allSuccess = results.every(r => r.success);
                
                resultDiv.innerHTML = `
                    <h5 class="${allSuccess ? 'success' : 'error'}">
                        ${allSuccess ? '‚úÖ Tous les tests r√©ussis!' : '‚ùå Certains tests ont √©chou√©'}
                    </h5>
                    ${results.map(r => `
                        <p>
                            <strong>${r.name}:</strong> 
                            <span class="${r.success ? 'success' : 'error'}">
                                ${r.success ? '‚úÖ' : '‚ùå'} 
                                "${r.detected}" ${r.success ? '=' : '‚â†'} "${r.expected}"
                            </span>
                        </p>
                    `).join('')}
                    <hr>
                    <p><strong>Score:</strong> ${results.filter(r => r.success).length}/${results.length}</p>
                `;
                
            } catch (error) {
                resultDiv.innerHTML = `<p class="error">Erreur: ${error.message}</p>`;
            }
        }
    </script>
</body>
</html>