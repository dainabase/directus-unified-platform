<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
    <meta http-equiv="X-UA-Compatible" content="ie=edge"/>
    <title>Gestion de Projets - SuperAdmin</title>
    
    <!-- CSS Tabler -->
    <link href="https://cdn.jsdelivr.net/npm/@tabler/core@latest/dist/css/tabler.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/@tabler/core@latest/dist/css/tabler-flags.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/@tabler/core@latest/dist/css/tabler-payments.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/@tabler/core@latest/dist/css/tabler-vendors.min.css" rel="stylesheet">
    
    <!-- Tabler Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@tabler/icons@latest/iconfont/tabler-icons.min.css">
    
    <!-- Modern Theme 2025 -->
    <link href="/assets/css/modern-theme.css" rel="stylesheet">
    <link href="/assets/css/glassmorphism.css" rel="stylesheet">
    <link href="/assets/css/animations.css" rel="stylesheet">
    
    <style>
        /* Dark mode toggle visibility */
        [data-bs-theme="dark"] .hide-theme-dark { display: none !important; }
        [data-bs-theme="light"] .hide-theme-light { display: none !important; }
        
        /* Glassmorphism style */
        .glass-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
        }

        [data-bs-theme="light"] .glass-card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(0, 0, 0, 0.1);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.15);
        }
        
        /* Kanban Styles */
        .kanban-column {
            min-height: 400px;
            padding: 0.5rem;
        }
        
        .kanban-card {
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 0.5rem;
            cursor: grab;
            transition: all 0.2s;
        }
        
        .kanban-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        
        .kanban-card.dragging {
            opacity: 0.5;
        }
        
        .project-priority-high { border-left: 4px solid #ef4444; }
        .project-priority-medium { border-left: 4px solid #f59e0b; }
        .project-priority-low { border-left: 4px solid #10b981; }
        
        .project-status-todo { background: rgba(107, 114, 128, 0.1); }
        .project-status-progress { background: rgba(59, 130, 246, 0.1); }
        .project-status-review { background: rgba(245, 158, 11, 0.1); }
        .project-status-done { background: rgba(16, 185, 129, 0.1); }
        
        /* Progress bar in cards */
        .project-progress {
            height: 4px;
            background: rgba(0, 0, 0, 0.1);
            border-radius: 2px;
            overflow: hidden;
            margin: 0.5rem 0;
        }
        
        .project-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #6366f1, #8b5cf6);
            transition: width 0.3s ease;
        }
        
        /* Gantt chart container */
        .gantt-container {
            overflow-x: auto;
            overflow-y: hidden;
        }
    </style>
</head>
<body data-bs-theme="dark" class="theme-modern">
    <!-- Mesh Gradient Background -->
    <div class="mesh-gradient-bg"></div>
    
    <div class="page">
        <!-- Sidebar -->
        <aside class="navbar navbar-vertical navbar-expand-lg navbar-superadmin" data-bs-theme="dark">
            <div class="container-fluid">
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#sidebar-menu">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <h1 class="navbar-brand navbar-brand-autodark">
                    <a href=".">
                        <img src="../assets/img/logo.svg" width="110" height="32" alt="Dashboard" class="navbar-brand-image">
                    </a>
                </h1>
                <div class="collapse navbar-collapse" id="sidebar-menu">
                    <ul class="navbar-nav pt-lg-3">
                        <!-- MENU SUPERADMIN -->
                        <li class="nav-item">
                            <a class="nav-link" href="./dashboard.html">
                                <span class="nav-link-icon d-md-none d-lg-inline-block">
                                    <i class="ti ti-home"></i>
                                </span>
                                <span class="nav-link-title">Dashboard Consolidé</span>
                            </a>
                        </li>
                        
                        <!-- SECTION CRM -->
                        <li class="nav-item">
                            <a class="nav-link" href="./crm.html">
                                <span class="nav-link-icon d-md-none d-lg-inline-block">
                                    <i class="ti ti-users"></i>
                                </span>
                                <span class="nav-link-title">CRM Multi-Entreprises</span>
                            </a>
                        </li>
                        
                        <!-- SECTION DEVIS & FACTURES -->
                        <li class="nav-item">
                            <a class="nav-link" href="./invoicing.html">
                                <span class="nav-link-icon d-md-none d-lg-inline-block">
                                    <i class="ti ti-file-invoice"></i>
                                </span>
                                <span class="nav-link-title">Devis & Factures</span>
                            </a>
                        </li>
                        
                        <!-- SECTION PROJETS -->
                        <li class="nav-item active">
                            <a class="nav-link" href="./projects.html">
                                <span class="nav-link-icon d-md-none d-lg-inline-block">
                                    <i class="ti ti-clipboard-check"></i>
                                </span>
                                <span class="nav-link-title">Gestion de Projets</span>
                            </a>
                        </li>
                        
                        <!-- SECTION DEVIS & FACTURES -->
                        <li class="nav-item">
                            <a class="nav-link" href="./invoicing.html">
                                <span class="nav-link-icon d-md-none d-lg-inline-block">
                                    <i class="ti ti-file-invoice"></i>
                                </span>
                                <span class="nav-link-title">Devis & Factures</span>
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </aside>
        
        <!-- Header -->
        <header class="navbar navbar-expand-md d-none d-lg-flex d-print-none">
            <div class="container-xl">
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar-menu">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="navbar-nav flex-row order-md-last">
                    <!-- Dark Mode Toggle -->
                    <div class="nav-item d-none d-md-flex me-3">
                        <div class="btn-list-item">
                            <a href="#" class="nav-link px-0 hide-theme-dark" title="Enable dark mode" data-bs-toggle="tooltip" data-bs-placement="bottom" onclick="document.body.setAttribute('data-bs-theme', 'dark')">
                                <i class="ti ti-moon"></i>
                            </a>
                            <a href="#" class="nav-link px-0 hide-theme-light" title="Enable light mode" data-bs-toggle="tooltip" data-bs-placement="bottom" onclick="document.body.setAttribute('data-bs-theme', 'light')">
                                <i class="ti ti-sun"></i>
                            </a>
                        </div>
                    </div>
                    
                    <!-- User menu -->
                    <div class="nav-item dropdown">
                        <a href="#" class="nav-link d-flex lh-1 text-reset p-0" data-bs-toggle="dropdown">
                            <span class="avatar avatar-sm" style="background-image: url(https://eu.ui-avatars.com/api/?name=Paul+Martin&background=c44569&color=fff)"></span>
                            <div class="d-none d-xl-block ps-2">
                                <div>Paul Martin</div>
                                <div class="mt-1 small text-secondary">
                                    <span class="badge bg-red">SUPERADMIN</span>
                                </div>
                            </div>
                        </a>
                        <div class="dropdown-menu dropdown-menu-end dropdown-menu-arrow">
                            <a href="#" class="dropdown-item">Mon Profil</a>
                            <a href="#" class="dropdown-item">Paramètres 2FA</a>
                            <div class="dropdown-divider"></div>
                            <a href="../logout.html" class="dropdown-item">Déconnexion</a>
                        </div>
                    </div>
                </div>
            </div>
        </header>
        
        <div class="page-wrapper">
            <div class="page-header d-print-none">
                <div class="container-xl">
                    <div class="row g-2 align-items-center">
                        <div class="col">
                            <div class="page-pretitle">Gestion multi-entreprises</div>
                            <h2 class="page-title">
                                Gestion de Projets
                            </h2>
                        </div>
                        <div class="col-auto ms-auto d-print-none">
                            <div class="btn-list">
                                <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#modal-project">
                                    <i class="ti ti-plus"></i>
                                    Nouveau Projet
                                </button>
                                <div class="dropdown">
                                    <button class="btn btn-white dropdown-toggle" data-bs-toggle="dropdown">
                                        <i class="ti ti-layout-kanban"></i>
                                        Vue: <span id="current-view">Kanban</span>
                                    </button>
                                    <div class="dropdown-menu">
                                        <a class="dropdown-item active" href="#" onclick="switchProjectView('kanban')">
                                            <i class="ti ti-layout-kanban me-2"></i>
                                            Vue Kanban
                                        </a>
                                        <a class="dropdown-item" href="#" onclick="switchProjectView('list')">
                                            <i class="ti ti-list me-2"></i>
                                            Vue Liste
                                        </a>
                                        <a class="dropdown-item" href="#" onclick="switchProjectView('gantt')">
                                            <i class="ti ti-chart-bar me-2"></i>
                                            Vue Gantt
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="page-body">
                <div class="container-xl">
                    <!-- Stats Cards -->
                    <div class="row row-cards mb-4">
                        <div class="col-sm-6 col-lg-3">
                            <div class="card card-sm glass-card">
                                <div class="card-body">
                                    <div class="row align-items-center">
                                        <div class="col-auto">
                                            <span class="bg-primary text-white avatar">
                                                <i class="ti ti-clipboard-check"></i>
                                            </span>
                                        </div>
                                        <div class="col">
                                            <div class="text-uppercase text-muted small font-weight-medium">Projets actifs</div>
                                            <div class="h2 mb-0" id="stats-active">47</div>
                                            <div class="text-muted">Toutes entreprises</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-6 col-lg-3">
                            <div class="card card-sm glass-card">
                                <div class="card-body">
                                    <div class="row align-items-center">
                                        <div class="col-auto">
                                            <span class="bg-green text-white avatar">
                                                <i class="ti ti-check"></i>
                                            </span>
                                        </div>
                                        <div class="col">
                                            <div class="text-uppercase text-muted small font-weight-medium">Terminés ce mois</div>
                                            <div class="h2 mb-0" id="stats-completed">12</div>
                                            <div class="text-muted">+3 vs mois dernier</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-6 col-lg-3">
                            <div class="card card-sm glass-card">
                                <div class="card-body">
                                    <div class="row align-items-center">
                                        <div class="col-auto">
                                            <span class="bg-yellow text-white avatar">
                                                <i class="ti ti-clock"></i>
                                            </span>
                                        </div>
                                        <div class="col">
                                            <div class="text-uppercase text-muted small font-weight-medium">En retard</div>
                                            <div class="h2 mb-0" id="stats-overdue">5</div>
                                            <div class="text-muted">Nécessitent attention</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-6 col-lg-3">
                            <div class="card card-sm glass-card">
                                <div class="card-body">
                                    <div class="row align-items-center">
                                        <div class="col-auto">
                                            <span class="bg-azure text-white avatar">
                                                <i class="ti ti-currency-euro"></i>
                                            </span>
                                        </div>
                                        <div class="col">
                                            <div class="text-uppercase text-muted small font-weight-medium">Budget total</div>
                                            <div class="h2 mb-0" id="stats-budget">€2.1M</div>
                                            <div class="text-muted">Projets en cours</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Filtres -->
                    <div class="card glass-card mb-3">
                        <div class="card-body">
                            <div class="row g-2">
                                <div class="col-md-3">
                                    <label class="form-label">Entreprise</label>
                                    <select class="form-select" id="filter-company">
                                        <option value="">Toutes les entreprises</option>
                                        <option value="hypervisual">HyperVisual</option>
                                        <option value="dynamics">Dynamics</option>
                                        <option value="lexia">Lexia</option>
                                        <option value="nkreality">NKReality</option>
                                        <option value="etekout">Etekout</option>
                                    </select>
                                </div>
                                <div class="col-md-2">
                                    <label class="form-label">Statut</label>
                                    <select class="form-select" id="filter-status">
                                        <option value="">Tous les statuts</option>
                                        <option value="todo">À faire</option>
                                        <option value="progress">En cours</option>
                                        <option value="review">En révision</option>
                                        <option value="done">Terminé</option>
                                    </select>
                                </div>
                                <div class="col-md-2">
                                    <label class="form-label">Priorité</label>
                                    <select class="form-select" id="filter-priority">
                                        <option value="">Toutes les priorités</option>
                                        <option value="high">Haute</option>
                                        <option value="medium">Moyenne</option>
                                        <option value="low">Basse</option>
                                    </select>
                                </div>
                                <div class="col-md-3">
                                    <label class="form-label">Rechercher</label>
                                    <input type="text" class="form-control" placeholder="Nom du projet..." id="search-projects">
                                </div>
                                <div class="col-md-2 d-flex align-items-end">
                                    <button class="btn btn-primary w-100" onclick="filterProjects()">
                                        <i class="ti ti-filter"></i> Filtrer
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Vue Kanban (par défaut) -->
                    <div id="kanban-view" class="project-view">
                        <div class="row">
                            <!-- Colonne À Faire -->
                            <div class="col-lg-3 col-md-6 mb-3">
                                <div class="card glass-card">
                                    <div class="card-header">
                                        <h3 class="card-title">À Faire</h3>
                                        <div class="card-actions">
                                            <span class="badge bg-secondary" id="todo-count">5</span>
                                        </div>
                                    </div>
                                    <div class="card-body p-2">
                                        <div class="kanban-column" id="todo-column">
                                            <!-- Cartes projets -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Colonne En Cours -->
                            <div class="col-lg-3 col-md-6 mb-3">
                                <div class="card glass-card">
                                    <div class="card-header">
                                        <h3 class="card-title">En Cours</h3>
                                        <div class="card-actions">
                                            <span class="badge bg-blue" id="progress-count">8</span>
                                        </div>
                                    </div>
                                    <div class="card-body p-2">
                                        <div class="kanban-column" id="progress-column">
                                            <!-- Cartes projets -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Colonne En Révision -->
                            <div class="col-lg-3 col-md-6 mb-3">
                                <div class="card glass-card">
                                    <div class="card-header">
                                        <h3 class="card-title">En Révision</h3>
                                        <div class="card-actions">
                                            <span class="badge bg-yellow" id="review-count">3</span>
                                        </div>
                                    </div>
                                    <div class="card-body p-2">
                                        <div class="kanban-column" id="review-column">
                                            <!-- Cartes projets -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Colonne Terminé -->
                            <div class="col-lg-3 col-md-6 mb-3">
                                <div class="card glass-card">
                                    <div class="card-header">
                                        <h3 class="card-title">Terminé</h3>
                                        <div class="card-actions">
                                            <span class="badge bg-green" id="done-count">12</span>
                                        </div>
                                    </div>
                                    <div class="card-body p-2">
                                        <div class="kanban-column" id="done-column">
                                            <!-- Cartes projets -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Vue Liste (cachée par défaut) -->
                    <div id="list-view" class="project-view d-none">
                        <div class="card glass-card">
                            <div class="table-responsive">
                                <table class="table table-vcenter card-table">
                                    <thead>
                                        <tr>
                                            <th>Projet</th>
                                            <th>Entreprise</th>
                                            <th>Client</th>
                                            <th>Chef de projet</th>
                                            <th>Statut</th>
                                            <th>Priorité</th>
                                            <th>Deadline</th>
                                            <th>Avancement</th>
                                            <th>Budget</th>
                                            <th class="w-1"></th>
                                        </tr>
                                    </thead>
                                    <tbody id="projects-list">
                                        <!-- Données dynamiques -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Vue Gantt (cachée par défaut) -->
                    <div id="gantt-view" class="project-view d-none">
                        <div class="card glass-card">
                            <div class="card-header">
                                <h3 class="card-title">Planning Gantt</h3>
                                <div class="card-actions">
                                    <div class="btn-group">
                                        <button class="btn btn-sm" onclick="setGanttPeriod('month')">Mois</button>
                                        <button class="btn btn-sm active" onclick="setGanttPeriod('quarter')">Trimestre</button>
                                        <button class="btn btn-sm" onclick="setGanttPeriod('year')">Année</button>
                                    </div>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="gantt-container">
                                    <div id="gantt-chart" style="height: 600px;">
                                        <!-- Gantt chart sera initialisé ici -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal Nouveau Projet -->
    <div class="modal modal-blur fade" id="modal-project" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content glass-card">
                <div class="modal-header">
                    <h5 class="modal-title">Nouveau Projet</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="project-form">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Nom du projet *</label>
                                <input type="text" class="form-control" id="project-name" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Entreprise *</label>
                                <select class="form-select" id="project-company" required>
                                    <option value="">Sélectionner une entreprise</option>
                                    <option value="hypervisual">HyperVisual</option>
                                    <option value="dynamics">Dynamics</option>
                                    <option value="lexia">Lexia</option>
                                    <option value="nkreality">NKReality</option>
                                    <option value="etekout">Etekout</option>
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Client *</label>
                                <select class="form-select" id="project-client" required>
                                    <option value="">Sélectionner un client</option>
                                    <!-- Chargé dynamiquement -->
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Chef de projet</label>
                                <select class="form-select" id="project-manager">
                                    <option value="">Sélectionner un chef de projet</option>
                                    <option value="paul-martin">Paul Martin</option>
                                    <option value="marie-dupont">Marie Dupont</option>
                                    <option value="jean-rousseau">Jean Rousseau</option>
                                    <option value="sophie-bernard">Sophie Bernard</option>
                                </select>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label">Date de début *</label>
                                <input type="date" class="form-control" id="project-start" required>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label">Date de fin *</label>
                                <input type="date" class="form-control" id="project-end" required>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label">Budget (€)</label>
                                <input type="number" class="form-control" id="project-budget" step="100">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Priorité</label>
                                <select class="form-select" id="project-priority">
                                    <option value="medium">Moyenne</option>
                                    <option value="high">Haute</option>
                                    <option value="low">Basse</option>
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Type de projet</label>
                                <select class="form-select" id="project-type">
                                    <option value="web">Développement Web</option>
                                    <option value="mobile">Application Mobile</option>
                                    <option value="design">Design</option>
                                    <option value="consulting">Consulting</option>
                                    <option value="maintenance">Maintenance</option>
                                    <option value="other">Autre</option>
                                </select>
                            </div>
                            <div class="col-12 mb-3">
                                <label class="form-label">Description</label>
                                <textarea class="form-control" rows="3" id="project-description"></textarea>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
                    <button type="submit" class="btn btn-primary" form="project-form">
                        <i class="ti ti-plus"></i>
                        Créer le projet
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- JS Tabler -->
    <script src="https://cdn.jsdelivr.net/npm/@tabler/core@latest/dist/js/tabler.min.js"></script>
    
    <!-- Pour le drag & drop (Kanban) -->
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>
    
    <!-- ApexCharts pour Gantt -->
    <script src="https://cdn.jsdelivr.net/npm/apexcharts@3.44.0/dist/apexcharts.min.js"></script>
    
    <script src="./js/projects.js"></script>
    
    <script>
        // Données simulées pour les projets
        const projectsData = [
            {
                id: 1,
                name: 'Site E-commerce TechCorp',
                company: 'HyperVisual',
                client: 'TechCorp SA',
                manager: 'Paul Martin',
                status: 'progress',
                priority: 'high',
                start_date: '2024-01-01',
                end_date: '2024-03-15',
                budget: 25000,
                progress: 65,
                type: 'web',
                description: 'Développement d\'une plateforme e-commerce complète'
            },
            {
                id: 2,
                name: 'App Mobile InnovateLab',
                company: 'Dynamics',
                client: 'InnovateLab',
                manager: 'Marie Dupont',
                status: 'todo',
                priority: 'medium',
                start_date: '2024-02-01',
                end_date: '2024-05-30',
                budget: 35000,
                progress: 0,
                type: 'mobile',
                description: 'Application mobile iOS/Android pour gestion laboratoire'
            },
            {
                id: 3,
                name: 'Refonte UX/UI DesignStudio',
                company: 'Lexia',
                client: 'DesignStudio',
                manager: 'Sophie Bernard',
                status: 'review',
                priority: 'medium',
                start_date: '2023-12-01',
                end_date: '2024-02-15',
                budget: 15000,
                progress: 90,
                type: 'design',
                description: 'Refonte complète de l\'interface utilisateur'
            },
            {
                id: 4,
                name: 'Maintenance ServTech',
                company: 'NKReality',
                client: 'ServTech',
                manager: 'Jean Rousseau',
                status: 'progress',
                priority: 'low',
                start_date: '2024-01-15',
                end_date: '2024-12-31',
                budget: 12000,
                progress: 40,
                type: 'maintenance',
                description: 'Maintenance préventive et corrective'
            },
            {
                id: 5,
                name: 'Consulting Digital Transform',
                company: 'Etekout',
                client: 'BigCorp',
                manager: 'Paul Martin',
                status: 'done',
                priority: 'high',
                start_date: '2023-10-01',
                end_date: '2024-01-31',
                budget: 45000,
                progress: 100,
                type: 'consulting',
                description: 'Accompagnement transformation digitale'
            }
        ];
        
        let currentView = 'kanban';
        let filteredProjects = [...projectsData];
        
        // Changer de vue
        function switchProjectView(view) {
            // Mettre à jour la vue active dans le dropdown
            document.querySelectorAll('.dropdown-item').forEach(item => item.classList.remove('active'));
            event.target.classList.add('active');
            document.getElementById('current-view').textContent = 
                view === 'kanban' ? 'Kanban' : view === 'list' ? 'Liste' : 'Gantt';
            
            // Cacher toutes les vues
            document.querySelectorAll('.project-view').forEach(v => v.classList.add('d-none'));
            
            // Afficher la vue sélectionnée
            document.getElementById(`${view}-view`).classList.remove('d-none');
            currentView = view;
            
            // Charger les données selon la vue
            if (view === 'kanban') {
                loadKanbanData();
            } else if (view === 'list') {
                loadListData();
            } else if (view === 'gantt') {
                loadGanttData();
            }
        }
        
        // Charger les données Kanban
        function loadKanbanData() {
            const columns = {
                todo: document.getElementById('todo-column'),
                progress: document.getElementById('progress-column'),
                review: document.getElementById('review-column'),
                done: document.getElementById('done-column')
            };
            
            // Vider les colonnes
            Object.values(columns).forEach(col => col.innerHTML = '');
            
            // Compteurs
            const counts = { todo: 0, progress: 0, review: 0, done: 0 };
            
            // Grouper par statut
            filteredProjects.forEach(project => {
                counts[project.status]++;
                
                const card = createProjectCard(project);
                columns[project.status].appendChild(card);
            });
            
            // Mettre à jour les compteurs
            document.getElementById('todo-count').textContent = counts.todo;
            document.getElementById('progress-count').textContent = counts.progress;
            document.getElementById('review-count').textContent = counts.review;
            document.getElementById('done-count').textContent = counts.done;
            
            // Initialiser le drag & drop
            initKanbanDragDrop();
        }
        
        // Créer une carte projet
        function createProjectCard(project) {
            const card = document.createElement('div');
            card.className = `kanban-card project-priority-${project.priority}`;
            card.draggable = true;
            card.dataset.projectId = project.id;
            
            const priorityColors = {
                high: '#ef4444',
                medium: '#f59e0b',
                low: '#10b981'
            };
            
            const statusLabels = {
                todo: 'À faire',
                progress: 'En cours',
                review: 'En révision',
                done: 'Terminé'
            };
            
            card.innerHTML = `
                <div class="d-flex justify-content-between align-items-start mb-2">
                    <h4 class="card-title">${project.name}</h4>
                    <div class="dropdown">
                        <button class="btn btn-ghost-secondary btn-sm dropdown-toggle" data-bs-toggle="dropdown">
                            <i class="ti ti-dots-vertical"></i>
                        </button>
                        <div class="dropdown-menu">
                            <a class="dropdown-item" href="#" onclick="editProject(${project.id})">
                                <i class="ti ti-edit me-2"></i>Modifier
                            </a>
                            <a class="dropdown-item" href="#" onclick="viewProject(${project.id})">
                                <i class="ti ti-eye me-2"></i>Voir détails
                            </a>
                            <div class="dropdown-divider"></div>
                            <a class="dropdown-item text-danger" href="#" onclick="deleteProject(${project.id})">
                                <i class="ti ti-trash me-2"></i>Supprimer
                            </a>
                        </div>
                    </div>
                </div>
                <div class="text-muted small mb-2">
                    <span class="badge bg-primary-lt">${project.company}</span>
                    <span class="ms-1">${project.client}</span>
                </div>
                <div class="text-muted small mb-2">
                    <i class="ti ti-user me-1"></i>${project.manager}
                </div>
                <div class="text-muted small mb-2">
                    <i class="ti ti-calendar me-1"></i>
                    ${new Date(project.end_date).toLocaleDateString('fr-FR')}
                </div>
                <div class="project-progress">
                    <div class="project-progress-bar" style="width: ${project.progress}%"></div>
                </div>
                <div class="d-flex justify-content-between align-items-center mt-2">
                    <small class="text-muted">${project.progress}% terminé</small>
                    <span class="badge" style="background-color: ${priorityColors[project.priority]}20; color: ${priorityColors[project.priority]}">
                        ${project.priority === 'high' ? 'Haute' : project.priority === 'medium' ? 'Moyenne' : 'Basse'}
                    </span>
                </div>
            `;
            
            return card;
        }
        
        // Initialiser le drag & drop Kanban
        function initKanbanDragDrop() {
            const columns = ['todo', 'progress', 'review', 'done'];
            
            columns.forEach(status => {
                const column = document.getElementById(`${status}-column`);
                new Sortable(column, {
                    group: 'projects',
                    animation: 150,
                    ghostClass: 'kanban-card-ghost',
                    onEnd: function(evt) {
                        const projectId = parseInt(evt.item.dataset.projectId);
                        const newStatus = evt.to.id.replace('-column', '');
                        
                        // Mettre à jour le statut du projet
                        updateProjectStatus(projectId, newStatus);
                    }
                });
            });
        }
        
        // Charger les données Liste
        function loadListData() {
            const tbody = document.getElementById('projects-list');
            
            tbody.innerHTML = filteredProjects.map(project => {
                const statusColors = {
                    todo: 'bg-secondary',
                    progress: 'bg-blue',
                    review: 'bg-yellow',
                    done: 'bg-green'
                };
                
                const priorityColors = {
                    high: 'bg-red',
                    medium: 'bg-orange',
                    low: 'bg-green'
                };
                
                return `
                    <tr>
                        <td>
                            <div>
                                <div class="font-weight-medium">${project.name}</div>
                                <div class="text-muted small">${project.type}</div>
                            </div>
                        </td>
                        <td>
                            <span class="badge bg-primary-lt">${project.company}</span>
                        </td>
                        <td>${project.client}</td>
                        <td>
                            <div class="d-flex align-items-center">
                                <span class="avatar avatar-sm me-2" style="background-image: url(https://eu.ui-avatars.com/api/?name=${encodeURIComponent(project.manager)}&background=random)"></span>
                                ${project.manager}
                            </div>
                        </td>
                        <td>
                            <span class="badge ${statusColors[project.status]}">
                                ${project.status === 'todo' ? 'À faire' : project.status === 'progress' ? 'En cours' : project.status === 'review' ? 'En révision' : 'Terminé'}
                            </span>
                        </td>
                        <td>
                            <span class="badge ${priorityColors[project.priority]}">
                                ${project.priority === 'high' ? 'Haute' : project.priority === 'medium' ? 'Moyenne' : 'Basse'}
                            </span>
                        </td>
                        <td class="text-muted">
                            ${new Date(project.end_date).toLocaleDateString('fr-FR')}
                        </td>
                        <td>
                            <div class="progress progress-sm">
                                <div class="progress-bar" style="width: ${project.progress}%" role="progressbar">
                                    <span class="visually-hidden">${project.progress}%</span>
                                </div>
                            </div>
                            <div class="text-muted small">${project.progress}%</div>
                        </td>
                        <td class="text-end">
                            <strong>€${project.budget.toLocaleString('fr-FR')}</strong>
                        </td>
                        <td>
                            <div class="btn-list flex-nowrap">
                                <a href="#" class="btn btn-white btn-sm" onclick="viewProject(${project.id})">
                                    Voir
                                </a>
                                <div class="dropdown">
                                    <button class="btn btn-white btn-sm dropdown-toggle" data-bs-toggle="dropdown">
                                        Actions
                                    </button>
                                    <div class="dropdown-menu dropdown-menu-end">
                                        <a class="dropdown-item" href="#" onclick="editProject(${project.id})">
                                            <i class="ti ti-edit me-2"></i>Modifier
                                        </a>
                                        <a class="dropdown-item" href="#" onclick="duplicateProject(${project.id})">
                                            <i class="ti ti-copy me-2"></i>Dupliquer
                                        </a>
                                        <div class="dropdown-divider"></div>
                                        <a class="dropdown-item text-danger" href="#" onclick="deleteProject(${project.id})">
                                            <i class="ti ti-trash me-2"></i>Supprimer
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </td>
                    </tr>
                `;
            }).join('');
        }
        
        // Charger les données Gantt
        function loadGanttData() {
            const options = {
                series: [{
                    data: filteredProjects.map(project => {
                        const start = new Date(project.start_date).getTime();
                        const end = new Date(project.end_date).getTime();
                        
                        return {
                            x: project.name,
                            y: [start, end],
                            fillColor: project.priority === 'high' ? '#ef4444' : 
                                      project.priority === 'medium' ? '#f59e0b' : '#10b981'
                        };
                    })
                }],
                chart: {
                    height: 550,
                    type: 'rangeBar',
                    toolbar: { show: true }
                },
                plotOptions: {
                    bar: {
                        horizontal: true,
                        barHeight: '50%',
                        rangeBarGroupRows: false
                    }
                },
                dataLabels: {
                    enabled: true,
                    formatter: function(val) {
                        const a = new Date(val[0]);
                        const b = new Date(val[1]);
                        const diff = Math.ceil((b - a) / (1000 * 60 * 60 * 24));
                        return diff + ' jours';
                    },
                    style: {
                        colors: ['#000']
                    }
                },
                xaxis: {
                    type: 'datetime',
                    labels: {
                        format: 'dd/MM'
                    }
                },
                yaxis: {
                    labels: {
                        style: {
                            fontSize: '12px'
                        }
                    }
                },
                grid: {
                    borderColor: 'rgba(0,0,0,0.1)',
                    strokeDashArray: 4
                }
            };
            
            // Détruire le graphique existant s'il existe
            if (window.ganttChart) {
                window.ganttChart.destroy();
            }
            
            window.ganttChart = new ApexCharts(document.querySelector("#gantt-chart"), options);
            window.ganttChart.render();
        }
        
        // Filtrer les projets
        function filterProjects() {
            const company = document.getElementById('filter-company').value;
            const status = document.getElementById('filter-status').value;
            const priority = document.getElementById('filter-priority').value;
            const search = document.getElementById('search-projects').value.toLowerCase();
            
            filteredProjects = projectsData.filter(project => {
                if (company && project.company.toLowerCase() !== company) return false;
                if (status && project.status !== status) return false;
                if (priority && project.priority !== priority) return false;
                if (search && !project.name.toLowerCase().includes(search)) return false;
                return true;
            });
            
            // Recharger la vue active
            if (currentView === 'kanban') {
                loadKanbanData();
            } else if (currentView === 'list') {
                loadListData();
            } else if (currentView === 'gantt') {
                loadGanttData();
            }
        }
        
        // Mettre à jour le statut d'un projet
        function updateProjectStatus(projectId, newStatus) {
            const project = projectsData.find(p => p.id === projectId);
            if (project) {
                project.status = newStatus;
                console.log(`Projet ${project.name} déplacé vers ${newStatus}`);
                // Ici on ferait un appel API pour sauvegarder
            }
        }
        
        // Actions sur les projets
        function viewProject(id) {
            console.log('Voir projet:', id);
        }
        
        function editProject(id) {
            console.log('Modifier projet:', id);
        }
        
        function deleteProject(id) {
            if (confirm('Êtes-vous sûr de vouloir supprimer ce projet ?')) {
                const index = projectsData.findIndex(p => p.id === id);
                if (index > -1) {
                    projectsData.splice(index, 1);
                    filterProjects(); // Recharger
                }
            }
        }
        
        function duplicateProject(id) {
            const project = projectsData.find(p => p.id === id);
            if (project) {
                const newProject = {
                    ...project,
                    id: Math.max(...projectsData.map(p => p.id)) + 1,
                    name: project.name + ' (Copie)',
                    status: 'todo',
                    progress: 0
                };
                projectsData.push(newProject);
                filterProjects(); // Recharger
            }
        }
        
        // Gestion du formulaire
        document.getElementById('project-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const newProject = {
                id: Math.max(...projectsData.map(p => p.id)) + 1,
                name: document.getElementById('project-name').value,
                company: document.getElementById('project-company').options[document.getElementById('project-company').selectedIndex].text,
                client: document.getElementById('project-client').options[document.getElementById('project-client').selectedIndex].text,
                manager: document.getElementById('project-manager').options[document.getElementById('project-manager').selectedIndex].text,
                status: 'todo',
                priority: document.getElementById('project-priority').value,
                start_date: document.getElementById('project-start').value,
                end_date: document.getElementById('project-end').value,
                budget: parseInt(document.getElementById('project-budget').value) || 0,
                progress: 0,
                type: document.getElementById('project-type').value,
                description: document.getElementById('project-description').value
            };
            
            projectsData.push(newProject);
            
            // Fermer le modal
            const modal = bootstrap.Modal.getInstance(document.getElementById('modal-project'));
            modal.hide();
            
            // Réinitialiser le formulaire
            this.reset();
            
            // Recharger la vue
            filterProjects();
            
            console.log('Nouveau projet créé:', newProject);
        });
        
        // Initialisation
        document.addEventListener('DOMContentLoaded', function() {
            // Définir les dates par défaut
            const today = new Date();
            document.getElementById('project-start').value = today.toISOString().split('T')[0];
            
            const nextMonth = new Date(today);
            nextMonth.setMonth(nextMonth.getMonth() + 1);
            document.getElementById('project-end').value = nextMonth.toISOString().split('T')[0];
            
            // Charger la vue par défaut
            loadKanbanData();
            
            console.log('Module Projets initialisé');
        });
    </script>
</body>
</html>