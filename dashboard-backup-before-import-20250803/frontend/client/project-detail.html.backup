<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Détail du Projet - Espace Client</title>
    
    <!-- Tabler CSS -->
    <link href="https://cdn.jsdelivr.net/npm/@tabler/core@1.0.0-beta20/dist/css/tabler.min.css" rel="stylesheet">
    <!-- Tabler Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@tabler/icons@latest/iconfont/tabler-icons.min.css">
    <!-- ApexCharts -->
    <link href="https://cdn.jsdelivr.net/npm/apexcharts@latest/dist/apexcharts.css" rel="stylesheet">
    <!-- Custom CSS -->
    <link href="../assets/css/custom.css" rel="stylesheet">
</head>
<body class="layout-fluid role-client">
    <div class="page">
        <!-- Navbar Top -->
        <header class="navbar navbar-expand-md navbar-light d-none d-lg-flex d-print-none">
            <!-- Le contenu sera chargé dynamiquement -->
        </header>

        <!-- Sidebar -->
        <aside class="navbar navbar-vertical navbar-expand-lg navbar-transparent">
            <div class="container-fluid">
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#sidebar-menu">
                    <span class="navbar-toggler-icon"></span>
                </button>
                
                <!-- Mobile Header -->
                <h1 class="navbar-brand navbar-brand-autodark d-lg-none">
                    <a href=".">
                        <img src="../assets/img/logo.svg" width="110" height="32" alt="Portal" class="navbar-brand-image">
                    </a>
                </h1>
                
                <!-- Mobile User Menu -->
                <div class="navbar-nav flex-row order-md-last d-lg-none">
                    <div class="nav-item d-none d-md-flex me-3">
                        <div class="btn-list-item">
                            <a href="#" class="btn btn-ghost-dark position-relative" data-bs-toggle="dropdown">
                                <i class="ti ti-bell icon"></i>
                                <span class="badge bg-red notification-badge"></span>
                            </a>
                        </div>
                    </div>
                    <div class="nav-item dropdown">
                        <a href="#" class="nav-link d-flex lh-1 text-reset p-0" data-bs-toggle="dropdown">
                            <span class="avatar avatar-sm user-avatar"></span>
                        </a>
                    </div>
                </div>
                
                <!-- Sidebar Content -->
                <div class="collapse navbar-collapse" id="sidebar-menu">
                    <!-- Le contenu sera chargé dynamiquement -->
                </div>
            </div>
        </aside>

        <!-- Page Wrapper -->
        <div class="page-wrapper">
            <!-- Page header -->
            <div class="page-header d-print-none">
                <div class="container-xl">
                    <div class="row g-2 align-items-center">
                        <div class="col">
                            <!-- Breadcrumb -->
                            <ol class="breadcrumb" aria-label="breadcrumbs">
                                <li class="breadcrumb-item"><a href="dashboard.html">Accueil</a></li>
                                <li class="breadcrumb-item"><a href="projects.html">Projets</a></li>
                                <li class="breadcrumb-item active" aria-current="page" id="project-name-breadcrumb">Refonte Site Web Corporate</li>
                            </ol>
                            <div class="page-header-content">
                                <div class="row align-items-center">
                                    <div class="col-auto">
                                        <span class="avatar avatar-lg bg-blue-lt">
                                            <i class="ti ti-world icon"></i>
                                        </span>
                                    </div>
                                    <div class="col">
                                        <h2 class="page-title" id="project-name">
                                            Refonte Site Web Corporate
                                        </h2>
                                        <div class="page-subtitle">
                                            <div class="row g-2 align-items-center">
                                                <div class="col-auto">
                                                    <span class="badge bg-green">En cours</span>
                                                </div>
                                                <div class="col-auto">
                                                    <span class="badge bg-red-lt">Priorité haute</span>
                                                </div>
                                                <div class="col-auto text-muted">
                                                    <i class="ti ti-calendar icon"></i>
                                                    Échéance: 30.03.2024
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-auto ms-auto">
                                        <div class="btn-list">
                                            <a href="#" class="btn btn-white">
                                                <i class="ti ti-download icon"></i>
                                                Exporter
                                            </a>
                                            <a href="#" class="btn btn-primary">
                                                <i class="ti ti-message icon"></i>
                                                Contacter l'équipe
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Page body -->
            <div class="page-body">
                <div class="container-xl">
                    <!-- Tabs navigation -->
                    <div class="card">
                        <div class="card-header">
                            <ul class="nav nav-tabs card-header-tabs" data-bs-toggle="tabs">
                                <li class="nav-item">
                                    <a href="#tab-overview" class="nav-link active" data-bs-toggle="tab">
                                        <i class="ti ti-info-circle icon me-2"></i>
                                        Vue d'ensemble
                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a href="#tab-tasks" class="nav-link" data-bs-toggle="tab">
                                        <i class="ti ti-list-check icon me-2"></i>
                                        Tâches
                                        <span class="badge bg-green ms-2">12</span>
                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a href="#tab-documents" class="nav-link" data-bs-toggle="tab">
                                        <i class="ti ti-files icon me-2"></i>
                                        Documents
                                        <span class="badge bg-blue ms-2">8</span>
                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a href="#tab-team" class="nav-link" data-bs-toggle="tab">
                                        <i class="ti ti-users icon me-2"></i>
                                        Équipe
                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a href="#tab-timeline" class="nav-link" data-bs-toggle="tab">
                                        <i class="ti ti-timeline icon me-2"></i>
                                        Timeline
                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a href="#tab-budget" class="nav-link" data-bs-toggle="tab">
                                        <i class="ti ti-credit-card icon me-2"></i>
                                        Budget
                                    </a>
                                </li>
                            </ul>
                        </div>
                        <div class="card-body">
                            <div class="tab-content">
                                <!-- Tab Vue d'ensemble -->
                                <div class="tab-pane active" id="tab-overview">
                                    <!-- Row 1: Info cards -->
                                    <div class="row row-cards mb-4">
                                        <div class="col-sm-6 col-lg-3">
                                            <div class="card">
                                                <div class="card-body">
                                                    <div class="subheader">Progression</div>
                                                    <div class="h1 mb-3">65%</div>
                                                    <div class="progress progress-sm">
                                                        <div class="progress-bar bg-green" style="width: 65%" role="progressbar"></div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-sm-6 col-lg-3">
                                            <div class="card">
                                                <div class="card-body">
                                                    <div class="subheader">Budget consommé</div>
                                                    <div class="h1 mb-3">CHF 45'200</div>
                                                    <div class="text-muted">sur CHF 80'000</div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-sm-6 col-lg-3">
                                            <div class="card">
                                                <div class="card-body">
                                                    <div class="subheader">Jours restants</div>
                                                    <div class="h1 mb-3">15</div>
                                                    <div class="text-muted">jusqu'au 30.03.2024</div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-sm-6 col-lg-3">
                                            <div class="card">
                                                <div class="card-body">
                                                    <div class="subheader">Tâches complétées</div>
                                                    <div class="h1 mb-3">8/12</div>
                                                    <div class="text-muted">66.7%</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Row 2: Details & Activity -->
                                    <div class="row row-cards">
                                        <div class="col-lg-6">
                                            <div class="card mb-3">
                                                <div class="card-header">
                                                    <h3 class="card-title">Détails du projet</h3>
                                                </div>
                                                <div class="card-body">
                                                    <dl class="row">
                                                        <dt class="col-5">Client:</dt>
                                                        <dd class="col-7">Direction Marketing</dd>
                                                        
                                                        <dt class="col-5">Type de projet:</dt>
                                                        <dd class="col-7">Développement Web</dd>
                                                        
                                                        <dt class="col-5">Date de début:</dt>
                                                        <dd class="col-7">15.01.2024</dd>
                                                        
                                                        <dt class="col-5">Date de fin prévue:</dt>
                                                        <dd class="col-7">30.03.2024</dd>
                                                        
                                                        <dt class="col-5">Responsable projet:</dt>
                                                        <dd class="col-7">
                                                            <div class="d-flex align-items-center">
                                                                <span class="avatar avatar-xs me-2">MD</span>
                                                                Marie D.
                                                            </div>
                                                        </dd>
                                                        
                                                        <dt class="col-5">Technologies:</dt>
                                                        <dd class="col-7">
                                                            <span class="badge bg-blue-lt">React</span>
                                                            <span class="badge bg-green-lt">Node.js</span>
                                                            <span class="badge bg-purple-lt">MongoDB</span>
                                                        </dd>
                                                    </dl>
                                                    
                                                    <div class="mt-3">
                                                        <h4 class="h5">Description</h4>
                                                        <p class="text-muted">
                                                            Refonte complète du site web corporate avec un nouveau design moderne, 
                                                            responsive et optimisé pour le SEO. Le projet inclut la migration de 
                                                            l'ancien CMS vers une solution headless, l'intégration d'un nouveau 
                                                            système de gestion de contenu et l'amélioration des performances.
                                                        </p>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <!-- Prochaines étapes -->
                                            <div class="card">
                                                <div class="card-header">
                                                    <h3 class="card-title">Prochaines étapes</h3>
                                                </div>
                                                <div class="list-group list-group-flush">
                                                    <div class="list-group-item">
                                                        <div class="row align-items-center">
                                                            <div class="col-auto">
                                                                <input type="checkbox" class="form-check-input">
                                                            </div>
                                                            <div class="col">
                                                                <div>Finaliser les maquettes desktop</div>
                                                                <div class="text-muted small">Échéance: 25.03.2024</div>
                                                            </div>
                                                            <div class="col-auto">
                                                                <span class="badge bg-red">Urgent</span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="list-group-item">
                                                        <div class="row align-items-center">
                                                            <div class="col-auto">
                                                                <input type="checkbox" class="form-check-input">
                                                            </div>
                                                            <div class="col">
                                                                <div>Tests utilisateurs phase 1</div>
                                                                <div class="text-muted small">Échéance: 28.03.2024</div>
                                                            </div>
                                                            <div class="col-auto">
                                                                <span class="badge bg-orange">Important</span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="list-group-item">
                                                        <div class="row align-items-center">
                                                            <div class="col-auto">
                                                                <input type="checkbox" class="form-check-input">
                                                            </div>
                                                            <div class="col">
                                                                <div>Intégration API de paiement</div>
                                                                <div class="text-muted small">Échéance: 02.04.2024</div>
                                                            </div>
                                                            <div class="col-auto">
                                                                <span class="badge bg-yellow">Normal</span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div class="col-lg-6">
                                            <!-- Timeline activité -->
                                            <div class="card mb-3">
                                                <div class="card-header">
                                                    <h3 class="card-title">Activité récente</h3>
                                                </div>
                                                <div class="card-body">
                                                    <div class="timeline timeline-simple">
                                                        <div class="timeline-item">
                                                            <div class="timeline-badge bg-green">
                                                                <i class="ti ti-check icon"></i>
                                                            </div>
                                                            <div class="timeline-content">
                                                                <div class="timeline-time text-muted">Il y a 2 heures</div>
                                                                <div class="timeline-title">Maquettes mobiles validées</div>
                                                                <div class="text-muted small">Par Marie D.</div>
                                                            </div>
                                                        </div>
                                                        <div class="timeline-item">
                                                            <div class="timeline-badge bg-blue">
                                                                <i class="ti ti-file-text icon"></i>
                                                            </div>
                                                            <div class="timeline-content">
                                                                <div class="timeline-time text-muted">Hier à 14h30</div>
                                                                <div class="timeline-title">Document ajouté</div>
                                                                <div class="text-muted small">Cahier des charges v2.pdf</div>
                                                            </div>
                                                        </div>
                                                        <div class="timeline-item">
                                                            <div class="timeline-badge bg-yellow">
                                                                <i class="ti ti-message icon"></i>
                                                            </div>
                                                            <div class="timeline-content">
                                                                <div class="timeline-time text-muted">Il y a 3 jours</div>
                                                                <div class="timeline-title">Commentaire ajouté</div>
                                                                <div class="text-muted small">Feedback sur l'intégration</div>
                                                            </div>
                                                        </div>
                                                        <div class="timeline-item">
                                                            <div class="timeline-badge bg-purple">
                                                                <i class="ti ti-git-merge icon"></i>
                                                            </div>
                                                            <div class="timeline-content">
                                                                <div class="timeline-time text-muted">Il y a 5 jours</div>
                                                                <div class="timeline-title">Milestone atteint</div>
                                                                <div class="text-muted small">Phase de design complétée</div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <!-- Graphiques -->
                                            <div class="card">
                                                <div class="card-header">
                                                    <h3 class="card-title">Burndown Chart</h3>
                                                </div>
                                                <div class="card-body">
                                                    <div id="chart-burndown" style="height: 250px;"></div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Row 3: Time repartition -->
                                    <div class="row row-cards mt-4">
                                        <div class="col-12">
                                            <div class="card">
                                                <div class="card-header">
                                                    <h3 class="card-title">Répartition du temps</h3>
                                                </div>
                                                <div class="card-body">
                                                    <div id="chart-time-repartition" style="height: 300px;"></div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Tab Tâches -->
                                <div class="tab-pane" id="tab-tasks">
                                    <div class="mb-3">
                                        <div class="row g-2">
                                            <div class="col">
                                                <input type="text" class="form-control" placeholder="Rechercher une tâche...">
                                            </div>
                                            <div class="col-auto">
                                                <select class="form-select">
                                                    <option>Toutes les tâches</option>
                                                    <option>À faire</option>
                                                    <option>En cours</option>
                                                    <option>Terminées</option>
                                                </select>
                                            </div>
                                            <div class="col-auto">
                                                <button class="btn btn-primary">
                                                    <i class="ti ti-plus icon"></i>
                                                    Nouvelle tâche
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="card">
                                        <div class="table-responsive">
                                            <table class="table table-vcenter card-table">
                                                <thead>
                                                    <tr>
                                                        <th>Tâche</th>
                                                        <th>Assignée à</th>
                                                        <th>Priorité</th>
                                                        <th>Statut</th>
                                                        <th>Échéance</th>
                                                        <th class="w-1"></th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <tr>
                                                        <td>
                                                            <div class="d-flex align-items-center">
                                                                <input type="checkbox" class="form-check-input me-2">
                                                                <div>
                                                                    <div>Intégration page d'accueil</div>
                                                                    <div class="text-muted small">#TASK-001</div>
                                                                </div>
                                                            </div>
                                                        </td>
                                                        <td>
                                                            <div class="d-flex align-items-center">
                                                                <span class="avatar avatar-xs me-2">JP</span>
                                                                Jean P.
                                                            </div>
                                                        </td>
                                                        <td><span class="badge bg-red">Haute</span></td>
                                                        <td><span class="badge bg-green">En cours</span></td>
                                                        <td>25.03.2024</td>
                                                        <td>
                                                            <a href="#" class="btn btn-ghost-secondary btn-icon">
                                                                <i class="ti ti-dots-vertical"></i>
                                                            </a>
                                                        </td>
                                                    </tr>
                                                    <!-- Plus de tâches... -->
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Tab Documents -->
                                <div class="tab-pane" id="tab-documents">
                                    <div class="row row-cards">
                                        <div class="col-md-6 col-lg-4">
                                            <div class="card">
                                                <div class="card-body">
                                                    <div class="d-flex align-items-center mb-3">
                                                        <span class="avatar me-3 bg-red-lt">
                                                            <i class="ti ti-file-text icon"></i>
                                                        </span>
                                                        <div>
                                                            <div class="font-weight-medium">Cahier des charges v2.pdf</div>
                                                            <div class="text-muted small">2.4 MB • Mis à jour il y a 2 jours</div>
                                                        </div>
                                                    </div>
                                                    <div class="d-flex">
                                                        <a href="#" class="btn btn-sm btn-primary">
                                                            <i class="ti ti-download icon"></i>
                                                            Télécharger
                                                        </a>
                                                        <a href="#" class="btn btn-sm btn-ghost-secondary ms-2">
                                                            <i class="ti ti-eye icon"></i>
                                                            Aperçu
                                                        </a>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <!-- Plus de documents... -->
                                    </div>
                                </div>
                                
                                <!-- Tab Équipe -->
                                <div class="tab-pane" id="tab-team">
                                    <div class="row row-cards">
                                        <div class="col-md-6 col-lg-4">
                                            <div class="card">
                                                <div class="card-body">
                                                    <div class="d-flex align-items-center mb-3">
                                                        <span class="avatar me-3">MD</span>
                                                        <div>
                                                            <div class="font-weight-medium">Marie D.</div>
                                                            <div class="text-muted small">Chef de projet</div>
                                                        </div>
                                                    </div>
                                                    <div class="mb-2">
                                                        <i class="ti ti-mail icon me-1"></i>
                                                        marie.d@prestataire.ch
                                                    </div>
                                                    <div>
                                                        <i class="ti ti-phone icon me-1"></i>
                                                        +41 22 123 45 67
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <!-- Plus de membres... -->
                                    </div>
                                </div>
                                
                                <!-- Tab Timeline -->
                                <div class="tab-pane" id="tab-timeline">
                                    <div class="timeline">
                                        <!-- Timeline complète du projet -->
                                    </div>
                                </div>
                                
                                <!-- Tab Budget -->
                                <div class="tab-pane" id="tab-budget">
                                    <div class="row row-cards">
                                        <div class="col-lg-6">
                                            <div class="card">
                                                <div class="card-header">
                                                    <h3 class="card-title">Répartition du budget</h3>
                                                </div>
                                                <div class="card-body">
                                                    <div id="chart-budget-pie" style="height: 300px;"></div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-lg-6">
                                            <div class="card">
                                                <div class="card-header">
                                                    <h3 class="card-title">Évolution des dépenses</h3>
                                                </div>
                                                <div class="card-body">
                                                    <div id="chart-budget-evolution" style="height: 300px;"></div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Zone pour notifications toast -->
    <div class="toast-container position-fixed bottom-0 end-0 p-3" id="toast-container"></div>

    <!-- Mobile Sidebar Overlay -->
    <div class="sidebar-overlay d-lg-none" onclick="PortalApp.toggleMobileSidebar()"></div>

    <!-- Tabler JS -->
    <script src="https://cdn.jsdelivr.net/npm/@tabler/core@1.0.0-beta20/dist/js/tabler.min.js"></script>
    <!-- ApexCharts -->
    <script src="https://cdn.jsdelivr.net/npm/apexcharts@latest/dist/apexcharts.min.js"></script>
    <!-- Custom JS -->
    <script src="../assets/js/app.js"></script>
    <script src="../assets/js/auth.js"></script>
    <script src="../assets/js/notion-connector.js"></script>
    <script src="../assets/js/auth-notion.js"></script>
    <script src="../assets/js/permissions-notion.js"></script>
    <script src="../assets/js/project-detail.js"></script>
    
    <script>
        // Vérification de l'authentification au chargement
        document.addEventListener('DOMContentLoaded', function() {
            // Vérifier l'authentification
            if (!PortalApp.checkAuth()) {
                console.warn('❌ Utilisateur non authentifié');
                window.location.href = '../login.html';
                return;
            }
            
            // Vérifier que l'utilisateur a le bon rôle
            if (PortalApp.currentRole !== 'client') {
                console.warn('❌ Accès non autorisé pour ce rôle');
                PortalApp.redirectToDashboard();
                return;
            }
            
            // Initialiser le layout
            if (typeof PortalApp.initLayout === 'function') {
                PortalApp.initLayout();
            }
            
            // Marquer le menu comme actif
            PortalApp.setActiveMenuItem('projects');
            
            // Récupérer l'ID du projet depuis l'URL
            const urlParams = new URLSearchParams(window.location.search);
            const projectId = urlParams.get('id');
            
            // Charger les détails du projet
            if (typeof loadProjectDetails === 'function') {
                loadProjectDetails(projectId);
            }
        });
    </script>
</body>
</html>